[{"content":"1. å‡†å¤‡åŸºç¡€é•œåƒ ä¸€èˆ¬æƒ…å†µï¼Œå¯ä»¥å‚è€ƒï¼š[GitHub Action] è‡ªåŠ¨åŒ–åˆ›å»ºï¼Œvllmæ„å»ºè¿‡ç¨‹æ‰€éœ€çš„ç£ç›˜å’Œå†…å­˜èµ„æºè¾ƒå¤§ï¼Œgithub actionæä¾›çš„å…è´¹èµ„æºä¸è¶³ï¼ˆ4c16g,14 ssdï¼‰ä¼šå¯¼è‡´é•œåƒæ„å»ºå¤±è´¥ã€‚éœ€è¦ä½¿ç”¨è‡ªå·±çš„æœåŠ¡å™¨\nå‚è€ƒhttps://github.com/vllm-project/vllm/blob/main/Dockerfile\nå¯çŸ¥ï¼Œæ‰€éœ€çš„åŸºç¡€é•œåƒå¦‚ä¸‹ï¼š å¦‚ç›®æ ‡cudaç‰ˆæœ¬ä¸º12.1.1,åˆ™éœ€è¦çš„åŸºç¡€é•œåƒä¸ºï¼š\nnvidia/cuda:12.1.1-devel-ubuntu20.04\nnvidia/cuda:12.1.1-devel-ubuntu22.04\næŸ¥è¯¢è¯¥é•œåƒæ˜¯å¦å­˜åœ¨ https://explore.ggcr.dev/\nä»¥ä¸Šé•œåƒç»„åˆå¼å­˜åœ¨çš„ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œå¯åœ¨è¯¥ç½‘ç«™æŸ¥è¯¢ç›¸è¿‘çš„é•œåƒç»„åˆ\nå¦‚é•œåƒåˆ—è¡¨ï¼šhttps://explore.ggcr.dev/?repo=nvidia%2Fcuda\nå¦‚æ‰¾ä¸åˆ°ç›®æ ‡åŸºç¡€é•œåƒæˆ–ç›¸é‚»é•œåƒä¹Ÿä¸æ»¡è¶³è¦æ±‚ï¼Œå¯ä»¥è€ƒè™‘æ„å»ºè‡ªå·±çš„åŸºç¡€é•œåƒï¼Œè§nvidia/cudaä»£ç åº“ï¼šhttps://gitlab.com/nvidia/container-images/cuda ã€‚ è¿™é‡Œæš‚ä¸å±•å¼€\n2. åŒæ­¥åŸºç¡€é•œåƒåˆ°å›½å†…é•œåƒä»“åº“ï¼ˆå¯é€‰ï¼Œå¦‚æœå…·å¤‡å¤–ç½‘æœåŠ¡å™¨æˆ–å¯è®¿é—®å®˜æ–¹çš„é•œåƒä»“åº“ï¼Œå¯ä¸åšï¼‰ ä½¿ç”¨githubå·¥ä½œæµè‡ªåŠ¨åŒæ­¥ï¼š\næ‰€æœ‰å·¥ä½œæµyaml:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 # å·¥ä½œæµåç§° name: Sync-Images-to-Aliyun-CR # å·¥ä½œæµè¿è¡Œæ—¶æ˜¾ç¤ºåç§° run-name: ${{ github.actor }} is Sync Images to Aliyun CR. # æ€æ ·è§¦å‘å·¥ä½œæµ on: push: branches: [ \u0026#34;main\u0026#34; ] # Allows you to run this workflow manually from the Actions tab workflow_dispatch: # å·¥ä½œæµç¨‹ä»»åŠ¡ï¼ˆé€šå¸¸å«æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæ­¥éª¤ï¼‰ jobs: syncimages: runs-on: ubuntu-latest steps: - name: Checkout Repos uses: actions/checkout@v4 - name: Login to Aliyun CR uses: docker/login-action@v3 with: registry: ${{ vars.ALY_REGISTRY}} username: ${{ secrets.ALY_UNAME }} password: ${{ secrets.ALY_PASSWD }} logout: false - uses: actions/setup-python@v5 with: python-version: \u0026#39;3.10\u0026#39; - run: python scrips/pull_image.py å¯¹åº”å¤„ç†é•œåƒä»£ç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 # -*- coding: utf-8 -*- import os,re,subprocess,datetime,json lines = [] rs = [] ds_reg = \u0026#39;registry.cn-hangzhou.aliyuncs.com/reg_pub/\u0026#39; with open(\u0026#39;images.txt\u0026#39;, \u0026#39;r\u0026#39;) as f: lines = f.read().split(\u0026#39;\\n\u0026#39;) for img in lines: # ims = re.split(\u0026#39;\\s+\u0026#39;, img) # p =None # if len(ims) \u0026gt; 1 and len(ims[1]) \u0026gt; 0: # p = ims[1] if len(img) \u0026gt; 0: ims = img.replace(\u0026#39;/\u0026#39;, \u0026#39;_\u0026#39;) ds = ds_reg + ims cmds = \u0026#39;skopeo copy --all docker://\u0026#39; + img + \u0026#39; docker://\u0026#39; + ds code,rss = subprocess.getstatusoutput(cmds) print(\u0026#39;*\u0026#39;*20+\u0026#39;\\n\u0026#39;+\u0026#34;copy {} to {}\u0026#34;.format(img, ds) + \u0026#39;\\n\u0026#39; + \u0026#34;rs:\\n code:{}\\n rs:{}\u0026#34;.format(code, rss) ) if code != 0: cmds = \u0026#39;docker pull \u0026#39; + img + \u0026#39; \u0026amp;\u0026amp; docker tag \u0026#39; + img + \u0026#39; \u0026#39; + ds + \u0026#39; \u0026amp;\u0026amp; docker push \u0026#39; + ds + \u0026#39; \u0026amp;\u0026amp; docker rmi {} {} \u0026#39;.format(img,ds) code,rss = subprocess.getstatusoutput(cmds) print(\u0026#39;skopeo copy error, try docker pull and push:\u0026#39; + \u0026#34;\\n\u0026#34; + cmds + \u0026#39;\\n\u0026#39; + \u0026#34;rs:\\n code:{}\\n rs:{}\u0026#34;.format(code, rss)) r = { \u0026#39;src\u0026#39;: img, \u0026#39;ds\u0026#39;: ds, \u0026#39;code\u0026#39;: code, \u0026#39;rs\u0026#39;: rss } rs.append(r) ctime =datetime.datetime.now().strftime(\u0026#39;%Y-%m-%d-%H:%M:%S\u0026#39;) with open(\u0026#39;result-{}.json\u0026#39;.format(ctime), encoding=\u0026#39;utf-8\u0026#39;, mode=\u0026#39;w\u0026#39;) as f: json.dump(rs, f) print(r) é•œåƒåŒæ­¥ä»£ç ä»“åº“ç»“æ„ï¼š 3. å‡†å¤‡Dockerfile 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 # æ³¨æ„ç¡®è®¤é•œåƒä¸­çš„æ“ä½œç³»ç»Ÿç‰ˆæœ¬+cudaç‰ˆæœ¬æ˜¯å¦å­˜åœ¨ï¼ŒæŸ¥çœ‹ï¼šhttps://explore.ggcr.dev/?repo=nvidia%2Fcuda FROM nvidia/cuda:12.1.1-devel-ubuntu22.04 AS vllm-base # cudaç‰ˆæœ¬ï¼švllmç›®å‰åªæ”¯æŒcuda 12.4ã€12.1ã€11.8 å…¶ä»–ç‰ˆæœ¬éœ€è¦è‡ªå·±ç¼–è¯‘ ARG CUDA_VERSION=121 # vllmç‰ˆæœ¬ ARG VLLM_VERSION=0.8.1 # é˜²æ­¢éœ€è¦äº¤äº’å¡ä¸»æ‰“åŒ…è¿‡ç¨‹ ENV DEBIAN_FRONTEND=noninteractive # æ›´æ–°ç¯å¢ƒ RUN apt update \u0026amp;\u0026amp; \\ apt install -y build-essential zlib1g-dev libncurses5-dev libgdbm-dev libnss3-dev libssl-dev libsqlite3-dev libreadline-dev libffi-dev libbz2-dev liblzma-dev tk-dev wget # å®‰è£…pythonï¼Œå¦‚éœ€å˜æ›´pythonç‰ˆæœ¬è¿™é‡Œè°ƒæ•´ RUN wget https://www.python.org/ftp/python/3.12.9/Python-3.12.9.tgz \u0026amp;\u0026amp; \\ tar -zxvf Python-3.12.9.tgz \u0026amp;\u0026amp; \\ cd Python-3.12.9 \u0026amp;\u0026amp; \\ ./configure --enable-optimizations --prefix=/usr/local/python3.12 \u0026amp;\u0026amp; make -j$(nproc) \u0026amp;\u0026amp; \\ make altinstall \u0026amp;\u0026amp; \\ ln -s /usr/local/python3.12/bin/python3.12 /usr/bin/python3 \u0026amp;\u0026amp; \\ ln -s /usr/local/python3.12/bin/pip3.12 /usr/bin/pip3 \u0026amp;\u0026amp; \\ ln -s /usr/local/python3.12/bin/pip3.12 /usr/bin/pip \u0026amp;\u0026amp; \\ rm -rf Python-3.12.9.tgz Python-3.12.9 # è®¾ç½®PATH ENV PATH=\u0026#34;/usr/bin:/usr/local/python3.12/bin:$PATH\u0026#34; # å®‰è£…vllm,æ³¨æ„æ‰€éœ€ç‰ˆæœ¬ï¼Œå¦‚æ— åˆé€‚çš„whléœ€è¦è€ƒè™‘è‡ªå·±ç¼–è¯‘æºç  RUN wget https://github.com/vllm-project/vllm/releases/download/v${VLLM_VERSION}/vllm-${VLLM_VERSION}+cu${CUDA_VERSION}-cp38-abi3-manylinux1_x86_64.whl RUN pip install vllm-${VLLM_VERSION}+cu${CUDA_VERSION}-cp38-abi3-manylinux1_x86_64.whl --extra-index-url https://download.pytorch.org/whl/cu${CUDA_VERSION} RUN rm -f vllm-${VLLM_VERSION}+cu${CUDA_VERSION}-cp38-abi3-manylinux1_x86_64.whl ENTRYPOINT [\u0026#34;python3\u0026#34;, \u0026#34;-m\u0026#34;, \u0026#34;vllm.entrypoints.openai.api_server\u0026#34;] ï»¿\n4. æ‰“é•œåƒå¹¶æ¨é€ æ ¸å¿ƒå‘½ä»¤å¦‚ä¸‹ï¼š\n1 2 3 docker build --tag vllm/vllm-openai . # å¦‚æœåŠ¡å™¨é…ç½®è¾ƒé«˜ï¼Œå¯ä»¥ä½¿ç”¨è¯¥å‚æ•°--build-arg max_jobs=8 --build-arg nvcc_threads=2 æˆ–é’ˆå¯¹æ€§è°ƒæ•´ï¼Œå¦‚èµ„ä¸€èˆ¬ï¼Œä¸å»ºè®®ä½¿ç”¨ docker tag vllm/vllm-openai registry.cn-hangzhou.aliyuncs.com/reg_pub/vllm_vllm-openai:cuda-12.1.1-20250320 docker push registry.cn-hangzhou.aliyuncs.com/reg_pub/vllm_vllm-openai:cuda-12.1.1-20250320 ï»¿\nï»¿\nï»¿\n","date":"2025-03-11T08:38:25Z","permalink":"https://blog.liu-nian.top/ai/%E6%9E%84%E5%BB%BA%E6%8C%87%E5%AE%9Acuda%E7%89%88%E6%9C%AC%E7%9A%84vllm%E9%95%9C%E5%83%8F/","title":"æ„å»ºæŒ‡å®šcudaç‰ˆæœ¬çš„vllmé•œåƒ"},{"content":"è®¡ç®—é‡è¯„ä¼° å‰é¦ˆç¥ç»ç½‘ç»œè®¡ç®—é‡ å‰é¦ˆç¥ç»ç½‘ç»œï¼šY = XW +B\nåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå®Œæˆçš„è¿ç®—å¦‚ä¸‹ï¼š\n$$ \\begin{bmatrix} x_0 \u0026amp; x_1 \u0026amp; x_2 \\end{bmatrix} \\times \\begin{bmatrix} w_{00} \u0026amp; w_{01} \\ w_{10} \u0026amp; w_{11} \\ w_{20} \u0026amp; w_{21} \\end{bmatrix} + \\begin{bmatrix} b_0 \\ b_1 \\end{bmatrix} $$\nå…¶ä¸­ï¼ŒWæ˜¯æƒé‡çŸ©é˜µï¼ŒXæ˜¯è¾“å…¥å‘é‡ï¼ŒBæ˜¯åç½®é¡¹ã€‚å³ï¼š\n$$ y = \\begin{bmatrix} y_0 \\ y_1 \\end{bmatrix} \\begin{matrix} y_0 = w_{00}x_0 + w_{01}x_1 + b_0\\ y_1 = w_{10}x_0 + w_{11}x_1 + b_1\\\n\\end{matrix} $$\nä¸Šè¿°2ä¸ªå…¬å¼ä¸­ï¼Œæ¯ä¸ªå…¬å¼éƒ½æœ‰3ä¸ªåŠ æ³•ã€3ä¸ªä¹˜æ³•è®¡ç®—ã€‚æ‰€ä»¥[1,3]çš„çŸ©é˜µå’Œ[3,2]çš„çŸ©é˜µç›¸ä¹˜å…±åŒ…å« 2132 =12 æ¬¡æµ®ç‚¹è®¡ç®—é‡(ç§°ä¸ºFLOPs)ã€‚ä»è€Œæ¨å¹¿åˆ°ä¸€èˆ¬ï¼š[m,k]çš„çŸ©é˜µå’Œ[k,n]çš„çŸ©é˜µç›¸ä¹˜ï¼Œéœ€è¦2mkn FLOPsã€‚è€ŒGPUåœ¨ä¸åŒç²¾åº¦å•ä½ä¸‹ï¼Œæµ®ç‚¹æ•°è¿ç®—çš„æ•ˆç‡æ˜¯ä¸åŒçš„ã€‚ä¾‹å¦‚ï¼ŒA100åœ¨16ä½ç²¾åº¦(FP16æˆ–BF16)ä¸‹æ¯ç§’å¯ä»¥è¿›è¡Œ$31410^{12}$æ¬¡æµ®ç‚¹è¿ç®—ã€‚è€Œåœ¨32ä½ç²¾åº¦ä¸‹ï¼Œæ¯ç§’åªèƒ½è¿›è¡Œ$15610^{12}$æ¬¡æµ®ç‚¹è¿ç®—ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥ç†æ‰€å½“ç„¶çš„æƒ³åˆ°ä¸€ä¸ªæé€Ÿæ€è·¯ - è®©æ‰€æœ‰è¿ç®—åœ¨ä½ç²¾åº¦ä¸‹è¿›è¡Œæ¥æé«˜è®­ç»ƒ/æ¨ç†æ•ˆç‡ã€‚ä½†æ˜¯ï¼Œè¿™é‡Œæœ‰ä¸ªæ— æ³•å¿½ç•¥çš„é—®é¢˜ï¼šæŸäº›è®¡ç®—å¿…é¡»è¦åœ¨é«˜ç²¾åº¦ä¸‹è¿›è¡Œã€‚ä¾‹å¦‚å…¨ç¨‹åœ¨ä½ç²¾åº¦ä¸‹è¿›è¡Œæ¨¡å‹è®­ç»ƒï¼Œå¾€å¾€ä¼šå‡ºç°ç”±äºç²¾åº¦ä¸å¤Ÿå¯¼è‡´æ•°å€¼æº¢å‡ºå’Œæ— æ³•æ”¶æ•›çš„é—®é¢˜ã€‚æ‰€ä»¥ç›®å‰å¤§æ¨¡å‹è®­ç»ƒé€šå¸¸é‡‡ç”¨çš„æ˜¯æ··åˆç²¾åº¦æ–¹å¼è¿›è¡Œï¼šå‰å‘ä¼ æ’­ã€åå‘ä¼ æ’­è¿™äº›æ— éœ€é«˜ç²¾åº¦çš„è®¡ç®—é‡‡ç”¨16ä½ç²¾åº¦(FP16æˆ–BF16)è¿›è¡Œï¼Œä¼˜åŒ–å™¨çŠ¶æ€æ›´æ–°åœ¨32ä½ç²¾åº¦(FP32)è¿›è¡Œã€‚è€Œæ¨¡å‹æ¨ç†çš„è¦æ±‚å°±æ¯”è¾ƒä½ï¼Œå¯ä»¥åœ¨16ä½ã€8ä½ç”šè‡³4ä½ç²¾åº¦è¿›è¡Œï¼Œæ•´ä¸ªä»»åŠ¡çš„è®¡ç®—æ•ˆç‡éå¸¸é«˜ã€‚\næ¨¡å‹è®¡ç®—é‡åˆ†æ $$ è®­ç»ƒè®¡ç®—é‡ = F_{å‰å‘ä¼ æ’­} + F_{åå‘ä¼ æ’­}\\ æ¨ç†è®¡ç®—é‡ = F_{å‰å‘ä¼ æ’­} \\ F_{åå‘ä¼ æ’­} = 2*F_{å‰å‘ä¼ æ’­} $$\næ¥ä¸‹æ¥è¿›è¡Œ$F_{å‰å‘ä¼ æ’­}$çš„è®¡ç®—æ¨å¯¼ï¼š\nå…ˆç¡®å®šç¬¦å·ï¼šæˆ‘ä»¬ä»¤Bå¯¹åº”batch sizeï¼Œså¯¹åº”sequence lengthï¼Œhå¯¹åº”hidden dimensionï¼Œlå¯¹åº”layers numberï¼›æ¥ç€ï¼Œæˆ‘ä»¬å†æ¥è§‚å¯Ÿå¤§æ¨¡å‹ç»“æ„ï¼šå¤§æ¨¡å‹æœ¬èº«ç”±lä¸ªtransformerå—ä¸²è”è€Œæˆã€‚æ­¤å¤–ï¼Œé¦–transformerå—å‰å’Œå°¾transformerå—åè¿˜æœ‰ä¸€äº›ç»“æ„ã€‚æ‰€ä»¥å¤§æ¨¡å‹çš„ç®—åŠ›ä¼°ç®—å¯ä»¥åˆ†ä¸ºä¸¤å¤§å—ï¼šä¸€ã€lä¸ªtransformerå—ä¸­çš„FLOPsï¼›äºŒã€å…¶ä»–ç»“æ„ä¸­çš„FLOPsï¼š\ntransformerå—ä¸­ï¼Œæ¯ä¸ªtransformerå—éƒ½ç”±å¤šå¤´æ³¨æ„åŠ›ç»“æ„å’ŒMLPä¸¤ç§ç»“æ„æ„æˆï¼š å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶æ‰€éœ€è®¡ç®—é‡ï¼š QKVè®¡ç®—é‡ï¼š\n$$ Q = XW^Q, K=XW^K, V=XW^V, å…¶ä¸­ï¼š x \\in [B,s,h], W^Q\\in[h,h/a] $$\næ¶‰åŠè®¡ç®—é‡å¤§è‡´å¦‚ä¸‹ï¼š\n$$ 32Bshh/aa=6Bsh^2,å…¶ä¸­aæ˜¯å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶çš„headæ•°ã€‚ $$\næ³¨æ„åŠ›è®¡ç®—é‡ï¼š\u0026lt;br\u0026gt;\næ³¨æ„åŠ›åˆ†æ•°è®¡ç®— å•å¤´æ³¨æ„åŠ›åˆ†æ•°ä¸€èˆ¬é‡‡ç”¨å¦‚ä¸‹è®¡ç®—ï¼š $$ attention = QK^T / \\sqrt(d_k) $$\nè®¡ç®—é‡ä¸ºï¼š\n$$ 2Bsh/a*s=2Bs^2h/a,å…¶ä¸­Q \\in [B,s,h/a], K^T \\in[B,h/a,s] $$\nå› æ­¤å¤šå¤´æ³¨æ„åŠ›åˆ†æ•°æ•´ä½“è®¡ç®—é‡ï¼š\n$$ 2Bs^2h/a*a=2Bsh^2 $$\næ³¨æ„åŠ›è¾“å‡ºå±‚è®¡ç®—é‡ï¼š å•å¤´æ³¨æ„åŠ›è¾“å‡ºå±‚è®¡ç®—é‡ï¼š è®¡ç®—å…¬å¼ä¸ºï¼š $$ Z= attention \\times V, å…¶ä¸­attention \\in [B,s,s], V\\in[B,s,h/a] $$\nè®¡ç®—é‡ä¸ºï¼š\n$$ 2Bss*h/a=2Bs^2h/a $$\nå› æ­¤å¤šå¤´æ³¨æ„åŠ›è¾“å‡ºå±‚è®¡ç®—é‡ä¸ºï¼š$2Bs^2h/a*a=2Bs^2h$\nå¤šå¤´æ³¨æ„åŠ›åˆå¹¶å±‚è®¡ç®—é‡\u0026lt;br\u0026gt; è®¡ç®—å…¬å¼ä¸ºï¼š\n$$ y = W^OZ + B \\ å…¶ä¸­,Z\\in[B,s,h], W^O \\in [h, h], Zä¸ºå¤šå¤´æ³¨æ„åŠ›è¾“å‡ºå±‚ç»“æœæ‹¼æ¥ $$\nè®¡ç®—é‡ä¸ºï¼š\n$$ 2Bsh*h=2Bsh^2 $$\nå› æ­¤æ•´ä¸ªè‡ªæ³¨æ„åŠ›å±‚çš„è®¡ç®—é‡ä¸ºï¼š\n$$ 4Bs^2h+8Bsh^2 $$\nMLPå±‚æ‰€éœ€è®¡ç®—é‡ æ¿€æ´»å€¼å’Œç¬¬ä¸€ä¸ªçº¿æ€§å±‚ç›¸ä¹˜ï¼š$[B,s,h]*[h,4h] å…±8Bsh^2$ FLOPsï¼› æ¿€æ´»å€¼å’Œç¬¬äºŒä¸ªçº¿æ€§å±‚ç›¸ä¹˜ï¼š$[B,s,4h]*[4h,h] å…±8Bsh^2$ FLOPsï¼› æ¿€æ´»å±‚ä¸ºçº¦0FLOPsï¼šGeLUæ˜¯ç¡®å®šçš„æ•°å­¦ç¼©æ”¾å…¬å¼ï¼Œå¯è®¤ä¸ºæ— éœ€çŸ©é˜µä¹˜ï¼› å•ä¸ªMLPå…±æœ‰åŒ…å«$16Bsh^2$$ FLOPsã€‚\u0026lt;br\u0026gt; å› æ­¤ï¼Œlä¸ªtransformerå—çš„FLOPsä¸ºï¼š$24Bsh^2+4Bs^2h$ï¼Œæ‰€æœ‰transformerå—çš„FLOPsä¸ºï¼š$l(24Bsh^2+4Bs^2h)$ã€‚\nå…¶ä»–ç»“æ„æ‰€éœ€è®¡ç®—é‡ ä¸»è¦æ˜¯æœ€ç»ˆè¾“å‡ºå±‚ï¼Œè®¡ç®—å…¬å¼ä¸ºï¼š\n$$ y = XW^O + B, å…¶ä¸­X\\in[B,s,h], W^O \\in [h,V], Vä¸ºå­—å…¸å¤§å° $$\nå…¶è®¡ç®—é‡å¤§å°ä¸ºï¼š\n$$ 2Bsh*V=2BsVh $$\nç»¼ä¸Šï¼Œæ•´ä¸ªæ¨¡å‹çš„å‰å‘ä¼ æ’­è®¡ç®—é‡ä¸ºï¼š\n$$ F_{å‰å‘ä¼ æ’­} = l(24Bsh^2+4Bs^2h)+2BsVh \\ = 24Bsh^2l+4Bs^2hl+2BsVh \\ = 24Bsh^2l(1+\\frac{s}{6h}+\\frac{V}{12lh}) $$\nè€Œé€šå¸¸åœ¨å¤§æ¨¡å‹ä¸­ï¼Œ6hè¿œå¤§äºsï¼Œ12lhè¿œå¤§äºVï¼Œæ‰€ä»¥è¿˜å¯ä»¥è¿›ä¸€æ­¥ç®€åŒ–ï¼š\n$$ F_{å‰å‘ä¼ æ’­} = 24Bsh^2l $$\nå› æ­¤å¯æ¨æ–­ï¼Œè®­ç»ƒä¸æ¨ç†æ‰€éœ€çš„è®¡ç®—é‡ä¸ºï¼š\n$$ F_{è®­ç»ƒ} = 3F_{å‰å‘ä¼ æ’­} = 72Bsh^2l \\ F_{è®­ç»ƒ} = 4F_{å‰å‘ä¼ æ’­} = 96Bsh^2l,å…¨é‡å‚æ•°è®¡ç®—æ—¶ \\ F_{æ¨ç†} = F_{å‰å‘ä¼ æ’­} = 24Bsh^2l $$\nç²—ç•¥ä¼°ç®—ä¸€èˆ¬åŸºäºtransformerçš„å¤§æ¨¡å‹çš„å‚æ•°é‡ä¸º$12lh^2$,å¯ä»¥å‘ç°ï¼š 1ï¼‰æ¨¡å‹è®­ç»ƒä¸­ï¼šå¦‚æœæ²¡æœ‰åº”ç”¨æ¿€æ´»å€¼é‡è®¡ç®—ï¼Œå•æ¨¡å‹å‰¯æœ¬å¤„ç†æ¯ä¸ªtokensæ—¶ï¼Œå•å‚æ•°ä¸Šç®—åŠ›éœ€æ±‚çº¦ä¸º6FLOPs($\\frac{72Bsh^2l}{12lh^2Bs}$)ã€‚å¦‚æœåº”ç”¨å…¨æ¿€æ´»å€¼é‡è®¡ç®—ï¼Œæå‡è‡³8FLOPsï¼› 2ï¼‰æ¨¡å‹æ¨ç†ä¸­ï¼šå•æ¨¡å‹å‰¯æœ¬å¤„ç†æ¯ä¸ªtokensæ—¶ï¼Œå•å‚æ•°ä¸Šç®—åŠ›éœ€æ±‚çº¦ä¸º6FLOPsï¼›\næœ€å¸¸ç”¨æ¥æµ‹é‡æ¯ç§’æµ®ç‚¹è¿ç®—æ¬¡æ•°çš„åŸºå‡†ç¨‹åºï¼ˆbenchmarkï¼‰ä¹‹ä¸€ï¼Œå°±æ˜¯Linpackã€‚ ä¸€ä¸ªMFLOPSï¼ˆmegaFLOPSï¼‰ç­‰äºæ¯ç§’ä¸€ç™¾ä¸‡ï¼ˆ=10^6ï¼‰æ¬¡çš„æµ®ç‚¹è¿ç®—ï¼Œ ä¸€ä¸ªGFLOPSï¼ˆgigaFLOPSï¼‰ç­‰äºæ¯ç§’åäº¿ï¼ˆ=10^9ï¼‰æ¬¡çš„æµ®ç‚¹è¿ç®—ï¼Œ ä¸€ä¸ªTFLOPSï¼ˆteraFLOPSï¼‰ç­‰äºæ¯ç§’ä¸€ä¸‡äº¿ï¼ˆ=10^12ï¼‰æ¬¡çš„æµ®ç‚¹è¿ç®—ï¼Œ ä¸€ä¸ªPFLOPSï¼ˆpetaFLOPSï¼‰ç­‰äºæ¯ç§’ä¸€åƒä¸‡äº¿ï¼ˆ=10^15ï¼‰æ¬¡çš„æµ®ç‚¹è¿ç®—ï¼Œ ä¸€ä¸ªEFLOPSï¼ˆexaFLOPSï¼‰ç­‰äºæ¯ç§’ä¸€ç™¾äº¿äº¿ï¼ˆ=10^18ï¼‰æ¬¡çš„æµ®ç‚¹è¿ç®—ã€‚\næ¨¡å‹è®­ç»ƒæ—¶é—´ä¼°ç®— æ ¹æ®é˜¿å§†è¾¾å°”å®šå¾‹ï¼Œç”±äºæ•´ä¸ªç³»ç»Ÿä¸­æœ‰ç½‘ç»œé€šä¿¡ç­‰æ— æ³•å¹¶è¡ŒåŠ é€Ÿé¡¹çš„å­˜åœ¨ï¼Œé›†ç¾¤ä¸­å­˜åœ¨åŠ é€Ÿæ¯”ä¸Šé™ã€‚é€šå¸¸ï¼Œè®­ç»ƒé›†ç¾¤ä¸­çš„GPUåˆ©ç”¨ç‡é€šå¸¸çº¦30%ï½55%ä¹‹é—´ã€‚é›†ç¾¤è®­ç»ƒè€—æ—¶è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š https://blog.csdn.net/weixin_43925843/article/details/145626893 https://www.nvidia.cn/data-center/v100/ https://github.com/hiyouga/LLaMA-Factory/blob/main/README_zh.md#%E8%BD%AF%E7%A1%AC%E4%BB%B6%E4%BE%9D%E8%B5%96\nLLaMA Factory å¾®è°ƒæ‰€éœ€çš„ç¡¬ä»¶èµ„æºè®¡ç®—ä¸»è¦åŸºäºæ¨¡å‹å‚æ•°é‡ã€å¾®è°ƒæ–¹æ³•å’Œè®­ç»ƒé…ç½®ä¸‰ä¸ªæ ¸å¿ƒç»´åº¦ã€‚ä»¥ä¸‹æ˜¯å…·ä½“è®¡ç®—æ–¹æ³•ä¸å…¸å‹åœºæ™¯ç¤ºä¾‹ï¼š\nä¸€ã€æ˜¾å­˜éœ€æ±‚è®¡ç®—å…¬å¼ æ˜¾å­˜å ç”¨ï¼ˆGBï¼‰ä¸»è¦åŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š\n$$ \\text{æ˜¾å­˜} = \\text{æ¨¡å‹å‚æ•°æ˜¾å­˜} + \\text{æ¢¯åº¦æ˜¾å­˜} + \\text{ä¼˜åŒ–å™¨çŠ¶æ€æ˜¾å­˜} + \\text{æ¿€æ´»å€¼æ˜¾å­˜} $$\n1. æ¨¡å‹å‚æ•°æ˜¾å­˜\nå…¨å‚æ•°å¾®è°ƒï¼ˆFP16ï¼‰ï¼šå‚æ•°é‡ Ã— 2 bytesï¼ˆä¾‹å¦‚ 7B æ¨¡å‹ï¼š7Ã—10â¹ Ã— 2 / 10â¹ = 14GBï¼‰ LoRAï¼ˆFP16ï¼‰ï¼šä»…éœ€å­˜å‚¨ä½ç§©çŸ©é˜µï¼ˆçº¦ 0.1%-1% å‚æ•°é‡ï¼‰ï¼ˆä¾‹å¦‚ 7B æ¨¡å‹ï¼š14GB Ã— 1% â‰ˆ 0.14GBï¼‰ QLoRAï¼ˆ4-bitï¼‰ï¼šå‚æ•°é‡ Ã— 0.5 bytes ï¼ˆä¾‹å¦‚ 7B æ¨¡å‹ï¼š7Ã—10â¹ Ã— 0.5 / 10â¹ = 3.5GBï¼‰ 2. æ¢¯åº¦ä¸ä¼˜åŒ–å™¨çŠ¶æ€\nå…¨å‚æ•°å¾®è°ƒï¼ˆAdamä¼˜åŒ–å™¨ï¼‰ï¼šå‚æ•°é‡ Ã— 4 bytesï¼ˆæ¢¯åº¦+ä¼˜åŒ–å™¨çŠ¶æ€ï¼‰ LoRA/QLoRAï¼šä»…éœ€å­˜å‚¨å°‘é‡æ¢¯åº¦ï¼ˆå¯å¿½ç•¥ï¼‰ 3. æ¿€æ´»å€¼æ˜¾å­˜ ä¸æ‰¹æ¬¡å¤§å°ï¼ˆbatch sizeï¼‰å’Œåºåˆ—é•¿åº¦ï¼ˆseq_lenï¼‰ç›¸å…³ï¼Œè®¡ç®—å…¬å¼ï¼š\n$$ \\text{æ¿€æ´»å€¼æ˜¾å­˜} \\approx \\text{batch_size} \\times \\text{seq_len} \\times \\text{hidden_dim} \\times 2 \\text{ bytes} $$\näºŒã€å…¸å‹åœºæ™¯ç¡¬ä»¶éœ€æ±‚ æ¨¡å‹è§„æ¨¡ å¾®è°ƒæ–¹æ³• æ˜¾å­˜éœ€æ±‚ï¼ˆä¼°ç®—ï¼‰ æ¨è GPU é…ç½® æ•°æ®æ¥æº 7B å…¨å‚æ•°ï¼ˆFP16ï¼‰ 60GB 2Ã—A100 80GB 7B QLoRAï¼ˆ4-bitï¼‰ 6GB å•å¡ RTX 3090/4090 13B LoRAï¼ˆFP16ï¼‰ 12GB å•å¡ A100 40GB 70B å…¨å‚æ•°ï¼ˆFP16ï¼‰ 600GB 8Ã—H100 80GBï¼ˆNVLinkï¼‰ ä¸‰ã€å…³é”®å½±å“å› ç´  å¾®è°ƒç®—æ³•é€‰æ‹©\nå…¨å‚æ•°å¾®è°ƒï¼šæ˜¾å­˜éœ€æ±‚æœ€é«˜ï¼Œé€‚åˆé«˜ç®—åŠ›é›†ç¾¤ã€‚ LoRA/QLoRAï¼šæ˜¾å­˜éœ€æ±‚é™ä½ 50%-90%ï¼Œé€‚åˆå•å¡è®­ç»ƒã€‚ GaLore/Freezeï¼šé€šè¿‡æ¢¯åº¦å‹ç¼©æˆ–å‚æ•°å†»ç»“è¿›ä¸€æ­¥ä¼˜åŒ–æ˜¾å­˜ã€‚ è®­ç»ƒé…ç½®ä¼˜åŒ–\næ‰¹æ¬¡å¤§å°ï¼ˆbatch_sizeï¼‰ï¼šå¢å¤§ batch_size ä¼šçº¿æ€§å¢åŠ æ¿€æ´»å€¼æ˜¾å­˜ã€‚ æ¢¯åº¦ç´¯ç§¯ï¼ˆgradient_accumulationï¼‰ï¼šé€šè¿‡ç´¯ç§¯æ¢¯åº¦å‡å°‘å•æ­¥æ˜¾å­˜éœ€æ±‚ã€‚ é‡åŒ–ä¸æ··åˆç²¾åº¦ï¼š4-bit/8-bit é‡åŒ–å¯é™ä½æ˜¾å­˜ 30%-70%ã€‚ åˆ†å¸ƒå¼è®­ç»ƒæ”¯æŒ LLaMA Factory æ”¯æŒ DeepSpeed ZeRO å’Œæ¨¡å‹å¹¶è¡Œï¼Œå¯å°†å¤§æ¨¡å‹æ‹†åˆ†åˆ°å¤šå¡ã€‚\nå››ã€å®æˆ˜ç¤ºä¾‹ï¼ˆ7Bæ¨¡å‹ + QLoRAï¼‰ ç¡¬ä»¶é…ç½®ï¼šRTX 4090ï¼ˆ24GB æ˜¾å­˜ï¼‰ è®­ç»ƒå‘½ä»¤ï¼š 1 2 3 4 5 6 llamafactory-cli train \\ --model_name_or_path meta-llama/Llama-3-8b \\ --finetuning_type qlora \\ --quantization_bit 4 \\ --per_device_train_batch_size 4 \\ --gradient_accumulation_steps 8 æ˜¾å­˜å ç”¨ï¼šçº¦ 10-12GBï¼ˆå«æ¿€æ´»å€¼ï¼‰ã€‚ äº”ã€èµ„æºä¼°ç®—å·¥å…· LLaMA Factory æä¾›æ˜¾å­˜ä¼°ç®—å·¥å…·ï¼Œå¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤ç”ŸæˆæŠ¥å‘Šï¼š\n1 llamafactory-cli estimate --model_name_or_path meta-llama/Llama-3-8b --finetuning_type lora å¦‚éœ€æ›´ç²¾ç¡®çš„è®¡ç®—ï¼Œå¯å‚è€ƒ Hugging Face çš„ Transformer æ˜¾å­˜è®¡ç®—å™¨ã€‚ https://mp.weixin.qq.com/s/CJxA-PxF_lvSpMr_7uHVVg\næ¨ç†æ‰€ç”¨æ˜¾å­˜ï¼š Total GPU Memory = æ¨¡å‹å¤§å° + KV Cache + Memory Overhead æœ€åè¿˜æ˜¯ä»¥ LLaMa-2 13B æ¥ä¸¾ä¾‹ã€‚å‡è®¾æœ‰ 10 ä¸ªå¹¶å‘è¯·æ±‚ï¼ŒåŒæ—¶è¯·æ±‚ LLaMa-2 13B ä»¥æœ€å¤§ Tokenæ•°(4096) è¿›è¡Œæ¨¡å‹æ¨ç†ã€‚ é‚£æœ€ç»ˆéœ€è¦çš„ GPU Memory è®¡ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š æ¨¡å‹å¤§å°= 13 Billion * 2 Bytes = 26 GB\nTotal KV cache= 800 KB * 4096 Tokens * 10 å¹¶å‘è¯·æ±‚ = 32 GB\nMemory Overhead= 0.1 * (26 GB + 32 GB) = 5.8 GB\næ‰€ä»¥æœ€ç»ˆéœ€è¦æ€» GPU memoryä¸º: 26 GB + 32 GB + 5.8 GB = 63.8 GBã€‚éœ€è¦ 2 å—è‹±ä¼Ÿè¾¾çš„ A100 èŠ¯ç‰‡æ‰å¯ä»¥ã€‚ https://github.com/manuelescobar-dev/LLM-Tools\nhttps://medium.com/@manuelescobar-dev/memory-requirements-for-llm-training-and-inference-97e4ab08091b\næ˜¾å­˜è®¡ç®— æ¨ç†æ˜¾å­˜è¯„ä¼°ï¼š\n$$ Total\\ Inference\\ Memory = Model Size + KV Cache + Activations $$\næ¨¡å‹å¤§å°ï¼š\nkv cacheï¼š\n$$ KV\\ Cache =2 Ã— Batch Size Ã— Sequence Length Ã— Number of Layers Ã— Hidden Size Ã— Precision $$\næ¿€æ´»å€¼ï¼š\n$$ Activation Memory = Batch Size Ã— Sequence Length Ã— Hidden Size Ã— ( 34 + 5 Ã— \\frac{Sequence Length Ã—Number of attention heads}{Hidden Size}) $$\næ¨ç†æ˜¾å­˜è¯„ä¼°ï¼š\n$$ Total Memory=Model Size+KV Cache+Activations+(Optimizer States+Gradients)Ã— Number of Trainable Parameters $$\nOptimizer States Optimization algorithms require resources to store the parameters and auxiliary variables. These variables include momentum and variance used by algorithms such as Adam (2 states) or SGD (1 state). The precision and type of optimizer affect memory usage.\nFormula [1]\nAdamW (2 states): 8 Bytes per parameter AdamW (bitsandbytes Quantized): 2 Bytes per parameter SGD (1 state): 4 Bytes per parameter Gradients Gradient values are computed during the backward pass of the model. They represent the rate of change of the loss function with respect to each model parameter and are crucial for updating the parameters during optimization. As with activations, they must be stored in FP32 for numerical stability.\nFormula [1]\n4 Bytes per parameter\n","date":"2025-02-19T08:38:25Z","permalink":"https://blog.liu-nian.top/ai/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83%E6%8E%A8%E7%90%86%E8%B5%84%E6%BA%90%E4%B8%8E%E8%AE%A1%E7%AE%97%E9%87%8F%E8%AF%84%E4%BC%B0/","title":"å¤§æ¨¡å‹è®­ç»ƒæ¨ç†èµ„æºä¸è®¡ç®—é‡è¯„ä¼°"},{"content":"ç›®æ ‡ docker-composeã€k8s-yaml\nå‡†å¤‡é•œåƒ è¿™é‡Œä»¥llama.cppçš„åŸºç¡€é•œåƒä½œä¸ºå‚è€ƒã€‚é€‰æ‹©llama.cppçš„åŸå› æ˜¯ä»–æ”¯æŒéå¸¸å¤šç§ç±»çš„åŠ é€Ÿå¡ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒcpuè¿è¡Œå¤§æ¨¡å‹ã€‚ ä½¿ç”¨å®˜æ–¹å·²æœ‰é•œåƒ å¦‚æœæœºå™¨ç¯å¢ƒçš„CUDAç‰ˆæœ¬ä¸å®˜æ–¹é•œåƒçš„å…¼å®¹ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨å®˜æ–¹é•œåƒã€‚ å‚è€ƒé“¾æ¥ï¼šhttps://github.com/ggerganov/llama.cpp/blob/master/docs/docker.md å¦‚æœæœ‰GPUï¼Œå»ºè®®ä½¿ç”¨ï¼šghcr.io/ggerganov/llama.cpp:server-cuda å¦‚æœæ²¡æœ‰gpuï¼Œå»ºè®®ä½¿ç”¨ï¼šghcr.io/ggerganov/llama.cpp:server å¦‚æœæƒ³è¦æ‹‰å–é»˜è®¤çš„åŸºç¡€é•œåƒä¸ºæœ€æ–°ç‰ˆæœ¬ï¼Œcheckä¸‹æœ€æ–°çš„dockerfileæ–‡ä»¶ï¼Œç¡®è®¤ä¸‹æ˜¯å¦ä¸è‡ªå·±ç¯å¢ƒçš„cudaç‰ˆæœ¬å…¼å®¹ã€‚é“¾æ¥å¦‚ä¸‹ï¼šhttps://github.com/ggerganov/llama.cpp/tree/master/.devops å¦‚æœæœ€æ–°çš„é•œåƒä¸èƒ½æ»¡è¶³éœ€æ±‚ï¼Œå¯ä»¥å°è¯•æœç´¢ä¸‹å†å²é•œåƒ å¯è®¿é—®é¡µé¢è¿›è¡Œæœç´¢:https://github.com/ggerganov/llama.cpp/pkgs/container/llama.cpp\nä»¥æœ€æ–°çš„é•œåƒä¸ºä¾‹ï¼Œå…·ä½“å‘½ä»¤å¦‚ä¸‹ï¼š\n1 2 docker pull ghcr.io/ggerganov/llama.cpp:server-cuda --platform linux/amd64 #å¦‚æœé•œåƒæ‹‰æ“ä½œç³»ç»Ÿä¸æœ€ç»ˆæ“ä½œç³»ç»Ÿä¸ä¸€è‡´ï¼Œéœ€è¦åŠ ä¸Š--platformå‚æ•°ã€‚å¦‚æœä¸€è‡´ï¼Œæ— éœ€æ·»åŠ ã€‚ docker save -o llama.cpp.tar ghcr.io/ggerganov/llama.cpp:server-cuda #å¦‚æœéœ€è¦ç¦»çº¿å¯¼å…¥ç›®æ ‡æœºå™¨ï¼Œå¯å°†é•œåƒä¿å­˜ä¸ºtaråŒ… è‡ªå®šä¹‰é•œåƒ å†å²é•œåƒå¯èƒ½ä¸æ»¡è¶³éœ€æ±‚ï¼Œå¯ä»¥å°è¯•è‡ªå®šä¹‰é•œåƒã€‚è¿™é‡Œä»¥cuda 11.8.0ä¸ºä¾‹ã€‚ æŸ¥çœ‹nvidia/cudaé•œåƒçš„tagï¼Œé€‰æ‹©åˆé€‚çš„ç‰ˆæœ¬ã€‚å‚è€ƒåœ°å€ï¼šhttps://hub.docker.com/r/nvidia/cuda/tags\nå‡†å¤‡llama.cppé•œåƒ 1 2 3 4 5 6 7 8 git clone https://github.com/ggerganov/llama.cpp cd llama.cpp vim .devops/cuda.Dockerfile # ä¿®æ”¹å¯¹åº”çš„cudaç‰ˆæœ¬ï¼Œæ³¨æ„æ“ä½œç³»ç»Ÿçš„ç‰ˆæœ¬ä¹Ÿè¦å’ŒåˆšæŸ¥åˆ°çš„é•œåƒä¿æŒä¸€è‡´ docker build -t llama.cpp:server-cuda-11.8 .devops/cuda.Dockerfile # ä¿å­˜ä¸ºtaråŒ…ï¼Œæ–¹ä¾¿ç¦»çº¿å¯¼å…¥ç›®æ ‡æœºå™¨ docker save -o llama.cpp-server-cuda-11.8.tar llama.cpp:server-cuda-11.8 # ä¹Ÿå¯é€‰æ‹©pushåˆ°è‡ªå·±çš„é•œåƒä»“åº“ docker push ${ your hub }/llama.cpp:server-cuda-11.8 Dockerfileç¤ºä¾‹:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 ARG UBUNTU_VERSION=20.04 # ä¿®æ”¹ä¸ºç›®æ ‡ç‰ˆæœ¬ # å¦‚æœç›®æ ‡ç‰ˆæœ¬ä¸º20.04ï¼Œä¼šå‡ºç°æ—¶åŒºé—®é¢˜å’Œcmakeç‰ˆæœ¬è¿‡ä½é—®é¢˜ï¼Œéœ€è¦å•ç‹¬è°ƒæ•´ # This needs to generally match the container host\u0026#39;s environment. ARG CUDA_VERSION=11.5.2 # ä¿®æ”¹ä¸ºç›®æ ‡ç‰ˆæœ¬ # Target the CUDA build image ARG BASE_CUDA_DEV_CONTAINER=nvidia/cuda:${CUDA_VERSION}-devel-ubuntu${UBUNTU_VERSION} # ç¡®ä¿dockerhubä¸­æœ‰è¯¥é•œåƒ ARG BASE_CUDA_RUN_CONTAINER=nvidia/cuda:${CUDA_VERSION}-runtime-ubuntu${UBUNTU_VERSION} # ç¡®ä¿dockerhubä¸­æœ‰è¯¥é•œåƒ ARG DEBIAN_FRONTEND=noninteractive FROM ${BASE_CUDA_DEV_CONTAINER} AS build # CUDA architecture to build for (defaults to all supported archs) ARG CUDA_DOCKER_ARCH=default # ç‰ˆæœ¬ä¸º20.04æ—¶ï¼Œéœ€è¦å•ç‹¬è°ƒæ•´æ—¶åŒºé—®é¢˜ï¼Œéœ€è¦è°ƒæ•´éƒ¨åˆ† ########################################### #ENV TZ=Etc/UTC # RUN apt-get update \u0026amp;\u0026amp; \\ # apt-get install -y tzdata wget tar build-essential python3 python3-pip git libcurl4-openssl-dev libgomp1 \u0026amp;\u0026amp; \\ # wget https://github.com/Kitware/CMake/releases/download/v3.31.5/cmake-3.31.5-linux-x86_64.tar.gz \u0026amp;\u0026amp; \\ # tar -zxvf cmake-3.31.5-linux-x86_64.tar.gz \u0026amp;\u0026amp; mv cmake-3.31.5-linux-x86_64 /opt/cmake \u0026amp;\u0026amp; \\ # ln -s /opt/cmake/bin/cmake /usr/bin/cmake \u0026amp;\u0026amp; cmake --version ########################################### RUN apt-get update \u0026amp;\u0026amp; \\ apt-get install -y build-essential cmake python3 python3-pip git libcurl4-openssl-dev libgomp1 WORKDIR /app COPY . . RUN if [ \u0026#34;${CUDA_DOCKER_ARCH}\u0026#34; != \u0026#34;default\u0026#34; ]; then \\ export CMAKE_ARGS=\u0026#34;-DCMAKE_CUDA_ARCHITECTURES=${CUDA_DOCKER_ARCH}\u0026#34;; \\ fi \u0026amp;\u0026amp; \\ cmake -B build -DGGML_NATIVE=OFF -DGGML_CUDA=ON -DLLAMA_CURL=ON ${CMAKE_ARGS} -DCMAKE_EXE_LINKER_FLAGS=-Wl,--allow-shlib-undefined . \u0026amp;\u0026amp; \\ cmake --build build --config Release -j$(nproc) RUN mkdir -p /app/lib \u0026amp;\u0026amp; \\ find build -name \u0026#34;*.so\u0026#34; -exec cp {} /app/lib \\; RUN mkdir -p /app/full \\ \u0026amp;\u0026amp; cp build/bin/* /app/full \\ \u0026amp;\u0026amp; cp *.py /app/full \\ \u0026amp;\u0026amp; cp -r gguf-py /app/full \\ \u0026amp;\u0026amp; cp -r requirements /app/full \\ \u0026amp;\u0026amp; cp requirements.txt /app/full \\ \u0026amp;\u0026amp; cp .devops/tools.sh /app/full/tools.sh ## Base image FROM ${BASE_CUDA_RUN_CONTAINER} AS base RUN apt-get update \\ \u0026amp;\u0026amp; apt-get install -y libgomp1 curl\\ \u0026amp;\u0026amp; apt autoremove -y \\ \u0026amp;\u0026amp; apt clean -y \\ \u0026amp;\u0026amp; rm -rf /tmp/* /var/tmp/* \\ \u0026amp;\u0026amp; find /var/cache/apt/archives /var/lib/apt/lists -not -name lock -type f -delete \\ \u0026amp;\u0026amp; find /var/cache -type f -delete COPY --from=build /app/lib/ /app # æ­¤å¤„åˆ é™¤äº†light full ç­‰ä¸å¿…è¦çš„é•œåƒä¿¡æ¯ï¼Œä»…ç•™äº†serverä¿¡æ¯ ### Server, Server only FROM base AS server ENV LLAMA_ARG_HOST=0.0.0.0 COPY --from=build /app/full/llama-server /app WORKDIR /app HEALTHCHECK CMD [ \u0026#34;curl\u0026#34;, \u0026#34;-f\u0026#34;, \u0026#34;http://localhost:8080/health\u0026#34; ] ENTRYPOINT [ \u0026#34;/app/llama-server\u0026#34; ] ä¹Ÿå¯é€‰æ‹©å°†llama.cppä»“åº“fork,ä¿®æ”¹ä¸ºç›®æ ‡ç‰ˆæœ¬çš„Dockerfileï¼Œç„¶åä½¿ç”¨githubçš„å·¥ä½œæµå»æ„å»ºé•œåƒã€‚å¯å‚è€ƒé•œåƒä»“åº“ï¼šhttps://github.com/Williamyzd/appbuilder.git å¯ç›´æ¥ä½¿ç”¨çš„tag:https://github.com/Williamyzd/appbuilder/pkgs/container/appbuilder%2Fllama.cpp\nå‡†å¤‡æ¨¡å‹ docker-composeæ’°å†™ k8s-yamlæ’°å†™ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 apiVersion: apps/v1 kind: Deployment metadata: name: qwen2-5-14b-gpu namespace: llms labels: app: qwen2-5-14b-gpu spec: replicas: 1 # å‰¯æœ¬æ•°é‡ selector: matchLabels: app: qwen2-5-14b-gpu template: metadata: labels: app: qwen2-5-14b-gpu spec: affinity: nodeAffinity: requiredDuringSchedulingIgnoredDuringExecution: nodeSelectorTerms: - matchExpressions: - key: kubernetes.io/cluster-role operator: In values: - slave - master-compute # - key: kubernetes.io/gpu-type-name # operator: In # values: # - Tesla-P4 containers: - name: qwen2-5-14b-gpu-gpu image: 10.233.0.100:5000/llama_cpp_gpu_12_2:cuda12.2_img-csbhtgdrp9ts131y # ä½¿ç”¨çš„é•œåƒ imagePullPolicy: IfNotPresent # é•œåƒæ‹‰å–ç­–ç•¥ #command: [\u0026#34;nvidia-smi\u0026#34;,\u0026#34;\u0026amp;\u0026amp;\u0026#34;,\u0026#34;tail\u0026#34;, \u0026#34;-f\u0026#34;,\u0026#34;/dev/null\u0026#34;] env: - name: LLAMA_ARG_MODEL value: \u0026#34;/models/qwen2.5-14b-instruct-q5_k_m.gguf\u0026#34; - name: LLAMA_ARG_PORT value: \u0026#34;8000\u0026#34; - name: LLAMA_ARG_UBATCH value: \u0026#34;4096\u0026#34; - name: LLAMA_ARG_HOST value: \u0026#34;0.0.0.0\u0026#34; - name: LLAMA_ARG_N_PARALLEL value: \u0026#34;2\u0026#34; - name: LLAMA_ARG_N_PREDICT value: \u0026#34;4096\u0026#34; - name: LLAMA_ARG_CTX_SIZE value: \u0026#34;12000\u0026#34; - name: LLAMA_ARG_N_GPU_LAYERS value: \u0026#34;10\u0026#34; # # vgpu èµ„æºé™åˆ¶ # - name: USE_GPU # value: \u0026#34;1\u0026#34; # - name: GPU_NUM # value: \u0026#34;100\u0026#34; resources: requests: memory: \u0026#34;1Gi\u0026#34; # è¯·æ±‚çš„å†…å­˜å¤§å° cpu: \u0026#34;1\u0026#34; # è¯·æ±‚çš„ CPU å¤§å°ï¼ˆä»¥æ¯«æ ¸ä¸ºå•ä½ï¼‰ limits: memory: \u0026#34;64Gi\u0026#34; # é™åˆ¶çš„å†…å­˜å¤§å° cpu: \u0026#34;8\u0026#34; securityContext: privileged: false runAsGroup: 0 runAsUser: 0 ports: - containerPort: 8000 # å®¹å™¨æš´éœ²çš„ç«¯å£ volumeMounts: - mountPath: /dev/shm name: cache-volume - mountPath: /models # subPath: v-wa9c73y3ge0wrvmm/org/william/qwen name: llm-models volumes: - name: cache-volume emptyDir: medium: Memory sizeLimit: \u0026#34;4Gi\u0026#34; # - name: gluster-llms # persistentVolumeClaim: # claimName: gluster-llms ### æ­¤å¤„æ ¹æ®å®é™…å¡«å†™ - hostPath: path: /models type: Directory name: llm-models --- apiVersion: v1 kind: Service metadata: name: qwen2-5-14b-gpu namespace: llms spec: selector: app: qwen2-5-14b-gpu # ç¡®ä¿è¿™ä¸ Deployment ä¸­ Pod çš„æ ‡ç­¾ç›¸åŒ¹é… ports: - protocol: TCP port: 8000 # Service ç›‘å¬çš„ç«¯å£ targetPort: 8000 # Pod å†…åº”ç”¨ç¨‹åºç›‘å¬çš„ç«¯å£ nodePort: 8512 # Node ä¸Šå¼€æ”¾çš„ç«¯å£ type: NodePort # Service ç±»å‹è®¾ç½®ä¸º NodePort æ­¤å¤„ä½¿ç”¨hostpathæŒ‚è½½æ¨¡å‹ï¼Œå¯æ ¹æ®å®é™…ç¯å¢ƒé€‰æ‹©æ›´é€‚åˆçš„å­˜å‚¨æ–¹å¼ã€‚ æ³¨æ„å¯¹hostpathæŒ‚è½½çš„ä½ç½®åšè°ƒæ•´ ","date":"2025-02-05T17:29:32+08:00","permalink":"https://blog.liu-nian.top/ai/%E5%A6%82%E4%BD%95%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BA%A7%E5%88%AB%E7%9A%84%E5%A4%A7%E6%A8%A1%E5%9E%8B%E6%8E%A8%E7%90%86%E5%8A%A1%E7%90%86/","title":"å¦‚ä½•éƒ¨ç½²ç”Ÿäº§çº§åˆ«çš„å¤§æ¨¡å‹æ¨ç†æœåŠ¡"},{"content":"llama.cppæ¨ç†-æ ‘è“æ´¾4b\nå‚è€ƒé“¾æ¥ï¼šhttps://github.com/ggerganov/llama.cpp\nhttps://qwen.readthedocs.io/zh-cn/latest/run_locally/llama.cpp.html\nè£¸æœºæ–¹å¼è¿è¡Œï¼Œéç‰¹æ®Šæ¡†æ¶ï¼Œå¯ä»¥ç›´æ¥æ‹‰å–å®˜æ–¹é•œåƒï¼š\nç¡¬ä»¶ä¿¡æ¯ï¼š\nå¹³å°æ¶æ„ï¼šaarch64\næ“ä½œç³»ç»Ÿ: Ubuntu 22.04.3 LTS\nCPU: 2\nMEM:4G\nåˆ›å»ºç¯å¢ƒ ä¸»è¦åŒ…æ‹¬æ‹‰å–ä»£ç ã€ä¸‹è½½æ¨¡å‹æˆ–ç”Ÿæˆæ¨¡å‹ç­‰æ­¥éª¤\n1 2 3 4 5 6 7 8 9 10 11 # 1. æ‹‰å–ä»£ç  git clone https://github.com/ggerganov/llama.cpp llmama.cpp # 2. ç¼–è¯‘ä»£ç  cd llama.cpp make make llama-cli # å¦‚æ— éœ€æœ¬åœ°äº¤äº’æµ‹è¯•ï¼Œä¸éœ€è¦æ‰§è¡Œ # 3. æ‰‹åŠ¨ä¸‹è½½æ¨¡å‹ #https://huggingface.co/Qwen/Qwen2-1.5B-Instruct-GGUF/tree/main https://huggingface.co/Qwen/Qwen2-1.5B-Instruct-GGUF/blob/main/qwen2-1_5b-instruct-q5_k_m.gguf # æˆ–è‡ªå·±ç”Ÿæˆï¼Œéœ€è¦pythonç¯å¢ƒ python convert-hf-to-gguf.py Qwen/Qwen2-7B-Instruct --outfile qwen2-1_5b-instruct-f16.gguf äº¤äº’å¼æµ‹è¯• å‚æ•°è¯´æ˜ï¼š\n-m æŒ‡æ¨¡å‹åœ°å€ -cnv æŒ‡ä¼šè¯æ¨¡å¼ -p æŒ‡çš„è¾“å…¥ä¿¡æ¯ï¼Œå¿…é¡»è¦ä¼ å…¥ 1 ./llama-cli -m models/qwen2-1_5b-instruct-q5_k_m.gguf -cnv -p \u0026#39;ä½ æ˜¯ä¸€ä¸ªäººå·¥æ™ºèƒ½ä¸“å®¶\u0026#39; è¿è¡ŒæˆåŠŸçš„æˆªå›¾å¦‚ä¸‹ï¼š\nAPI å‘å¸ƒæµ‹è¯• 1 ./llama-server -m /opt/codes/models/qwen2-1_5b-instruct-q5_k_m.gguf --port 8000 --host 0.0.0.0 å‰å°é¡µé¢è®¿é—®æµ‹è¯•\nhttp://192.168.2.189:8080/\n","date":"2024-09-25T08:38:25Z","permalink":"https://blog.liu-nian.top/ai/llama.cpp/","title":"llama.cppæ¨ç†-æ ‘è“æ´¾4b"},{"content":"ç¡¬ä»¶ä¿¡æ¯ï¼š\nBCC: 2æ ¸8G\nåˆ›å»ºæ¨ç†ç¯å¢ƒ å‚è€ƒé“¾æ¥\nhttps://docs.vllm.ai/en/stable/getting_started/cpu-installation.html\nhttps://github.com/Williamyzd/vllm/blob/main/Dockerfile.cpu\nhttps://github.com/vllm-project/vllm/blob/main/requirements-cpu.txt\nhttps://www.cnblogs.com/obullxl/p/18353447/NTopic2024081101\nå‡†å¤‡é•œåƒ\n1 2 3 4 5 6 7 8 9 10 # æ‹‰å–ä»£ç  #å¦‚æœæ²¡æœ‰gitéœ€è¦å…ˆå®‰è£… yum install git git clone https://github.com/vllm-project/vllm.git vllm-project cd vllm-project # æ‰“é•œåƒ # ä»¥ä¸‹å‘½ä»¤åœ¨ Docker version 26.1.4 ä¸­æµ‹è¯• # å¯ç¼–è¾‘Dockerfile.cpuåšä¼˜åŒ– # 1. ä¿®æ”¹åŸºç¡€é•œåƒä¸ºï¼šregistry.cn-hangzhou.aliyuncs.com/reg_pub/ubuntu:22.04 # 2. è°ƒæ•´pipæºå’Œsourceä¸ºå›½å†…æº docker build -f Dockerfile.cpu -t vllm-cpu-env --shm-size=4g . å¦‚æœæ‰§è¡Œé€Ÿåº¦æ…¢å¯ä»¥è€ƒè™‘åŠ ä¸Šå›½å†…æº 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 #!/bin/bash # æ·»åŠ æ¸…åpipæº pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple # å¤‡ä»½åŸæœ‰çš„sources.listæ–‡ä»¶ sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak # åˆ›å»ºä¸€ä¸ªæ–°çš„sources.listæ–‡ä»¶ï¼Œå¹¶æ·»åŠ æ¸…åæº cat \u0026gt; /etc/apt/sources.list \u0026lt;\u0026lt;EOF # é»˜è®¤æ³¨é‡Šäº†æºç é•œåƒä»¥æé«˜ apt update é€Ÿåº¦ï¼Œå¦‚æœ‰éœ€è¦å¯è‡ªè¡Œå–æ¶ˆæ³¨é‡Š deb https://mirrors.aliyun.com/ubuntu/ jammy main restricted universe multiverse deb-src https://mirrors.aliyun.com/ubuntu/ jammy main restricted universe multiverse deb https://mirrors.aliyun.com/ubuntu/ jammy-security main restricted universe multiverse deb-src https://mirrors.aliyun.com/ubuntu/ jammy-security main restricted universe multiverse deb https://mirrors.aliyun.com/ubuntu/ jammy-updates main restricted universe multiverse deb-src https://mirrors.aliyun.com/ubuntu/ jammy-updates main restricted universe multiverse # deb https://mirrors.aliyun.com/ubuntu/ jammy-proposed main restricted universe multiverse # deb-src https://mirrors.aliyun.com/ubuntu/ jammy-proposed main restricted universe multiverse deb https://mirrors.aliyun.com/ubuntu/ jammy-backports main restricted universe multiverse deb-src https://mirrors.aliyun.com/ubuntu/ jammy-backports main restricted universe multiverse EOF dockerfileæ ·ä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 # https://github.com/Williamyzd/vllm/blob/main/Dockerfile.cpu # This vLLM Dockerfile is used to construct image that can build and run vLLM on x86 CPU platform. # \u0026gt;\u0026gt;\u0026gt;\u0026gt;\u0026gt;\u0026gt;\u0026gt;æ›´æ¢ä¸ºå›½å†…é•œåƒ FROM registry.cn-hangzhou.aliyuncs.com/reg_pub/ubuntu:22.04 AS cpu-test-1 ENV CCACHE_DIR=/root/.cache/ccache ENV CMAKE_CXX_COMPILER_LAUNCHER=ccache # \u0026gt;\u0026gt;\u0026gt;\u0026gt;\u0026gt;\u0026gt;\u0026gt;æ·»åŠ å›½å†…æº RUN cp /etc/apt/sources.list /etc/apt/sources.list.bak \\ \u0026amp;\u0026amp; echo \u0026#34;deb https://mirrors.aliyun.com/ubuntu/ jammy main restricted universe multiverse\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list \\ \u0026amp;\u0026amp; echo \u0026#34;deb-src https://mirrors.aliyun.com/ubuntu/ jammy main restricted universe multiverse\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list \\ \u0026amp;\u0026amp; echo \u0026#34;deb https://mirrors.aliyun.com/ubuntu/ jammy-security main restricted universe multiverse\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list \\ \u0026amp;\u0026amp; echo \u0026#34;deb-src https://mirrors.aliyun.com/ubuntu/ jammy-security main restricted universe multiverse\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list \\ \u0026amp;\u0026amp; echo \u0026#34;deb https://mirrors.aliyun.com/ubuntu/ jammy-updates main restricted universe multiverse\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list \\ \u0026amp;\u0026amp; echo \u0026#34;deb-src https://mirrors.aliyun.com/ubuntu/ jammy-updates main restricted universe multiverse\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list \\ \u0026amp;\u0026amp; echo \u0026#34;deb https://mirrors.aliyun.com/ubuntu/ jammy-backports main restricted universe multiverse\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list \\ \u0026amp;\u0026amp; echo \u0026#34;deb-src https://mirrors.aliyun.com/ubuntu/ jammy-backports main restricted universe multiverse\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list # \u0026gt;\u0026gt;\u0026gt;\u0026gt;\u0026gt;\u0026gt;\u0026gt;è¿™é‡Œæ·»åŠ äº†æ¸…åpipæº RUN --mount=type=cache,target=/var/cache/apt \\ apt-get update -y \\ \u0026amp;\u0026amp; apt-get install -y curl ccache git wget vim numactl gcc-12 g++-12 python3 python3-pip libtcmalloc-minimal4 libnuma-dev \\ \u0026amp;\u0026amp; apt-get install -y ffmpeg libsm6 libxext6 libgl1 \\ \u0026amp;\u0026amp; update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-12 10 --slave /usr/bin/g++ g++ /usr/bin/g++-12 \\ \u0026amp;\u0026amp; pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple # https://intel.github.io/intel-extension-for-pytorch/cpu/latest/tutorials/performance_tuning/tuning_guide.html # intel-openmp provides additional performance improvement vs. openmp # tcmalloc provides better memory allocation efficiency, e.g, holding memory in caches to speed up access of commonly-used objects. RUN --mount=type=cache,target=/root/.cache/pip \\ pip install intel-openmp ENV LD_PRELOAD=\u0026#34;/usr/lib/x86_64-linux-gnu/libtcmalloc_minimal.so.4:/usr/local/lib/libiomp5.so\u0026#34; RUN echo \u0026#39;ulimit -c 0\u0026#39; \u0026gt;\u0026gt; ~/.bashrc RUN pip install https://intel-extension-for-pytorch.s3.amazonaws.com/ipex_dev/cpu/intel_extension_for_pytorch-2.4.0%2Bgitfbaa4bc-cp310-cp310-linux_x86_64.whl ENV PIP_EXTRA_INDEX_URL=https://download.pytorch.org/whl/cpu RUN --mount=type=cache,target=/root/.cache/pip \\ --mount=type=bind,src=requirements-build.txt,target=requirements-build.txt \\ pip install --upgrade pip \u0026amp;\u0026amp; \\ pip install -r requirements-build.txt # install oneDNN RUN git clone -b rls-v3.5 https://github.com/oneapi-src/oneDNN.git RUN --mount=type=cache,target=/root/.cache/ccache \\ cmake -B ./oneDNN/build -S ./oneDNN -G Ninja -DONEDNN_LIBRARY_TYPE=STATIC \\ -DONEDNN_BUILD_DOC=OFF \\ -DONEDNN_BUILD_EXAMPLES=OFF \\ -DONEDNN_BUILD_TESTS=OFF \\ -DONEDNN_BUILD_GRAPH=OFF \\ -DONEDNN_ENABLE_WORKLOAD=INFERENCE \\ -DONEDNN_ENABLE_PRIMITIVE=MATMUL \u0026amp;\u0026amp; \\ cmake --build ./oneDNN/build --target install --config Release FROM cpu-test-1 AS build WORKDIR /workspace/vllm RUN --mount=type=cache,target=/root/.cache/pip \\ --mount=type=bind,src=requirements-common.txt,target=requirements-common.txt \\ --mount=type=bind,src=requirements-cpu.txt,target=requirements-cpu.txt \\ pip install -v -r requirements-cpu.txt COPY ./ ./ # Support for building with non-AVX512 vLLM: docker build --build-arg VLLM_CPU_DISABLE_AVX512=\u0026#34;true\u0026#34; ... ARG VLLM_CPU_DISABLE_AVX512 ENV VLLM_CPU_DISABLE_AVX512=${VLLM_CPU_DISABLE_AVX512} RUN --mount=type=cache,target=/root/.cache/pip \\ --mount=type=cache,target=/root/.cache/ccache \\ VLLM_TARGET_DEVICE=cpu python3 setup.py bdist_wheel \u0026amp;\u0026amp; \\ pip install dist/*.whl WORKDIR /workspace/ RUN ln -s /workspace/vllm/tests \u0026amp;\u0026amp; ln -s /workspace/vllm/examples \u0026amp;\u0026amp; ln -s /workspace/vllm/benchmarks ENTRYPOINT [\u0026#34;python3\u0026#34;, \u0026#34;-m\u0026#34;, \u0026#34;vllm.entrypoints.openai.api_server\u0026#34;] ä¸‹è½½æ¨¡å‹æ–‡ä»¶ æ–¹æ³•ä¸€ï¼šä½¿ç”¨git 1 2 3 4 5 6 7 # ä½¿ç”¨git ä¸‹è½½ï¼Œæ–‡ä»¶æ¯”è¾ƒå¤§ï¼Œå› è€Œä½¿ç”¨git-lfsæ¥æ”¯æŒæ–­ç‚¹ç»­ä¼  å®‰è£…å‚è€ƒï¼šhttps://github.com/git-lfs/git-lfs/blob/main/INSTALLING.md curl -s https://packagecloud.io/install/repositories/github/git-lfs/script.rpm.sh | sudo bash yum install git-lfs mkdir -p ~/ModelSpace \u0026amp;\u0026amp; cd ~/ModelSpace git lfs install git clone https://www.modelscope.cn/qwen/qwen2-0.5b.git Qwen2-0.5B æ–¹æ³•äºŒï¼šç›´æ¥ä½¿ç”¨modelscopeå·¥å…· 1 2 3 4 pip install modelscope modelscope download --model qwen/qwen2-0.5b --local_dir ~/ModelSpace/ #modelscope -h æŸ¥çœ‹ä½¿ç”¨è¯´æ˜ #https://www.modelscope.cn/docs/%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%B8%8B%E8%BD%BD è¿è¡Œæµ‹è¯• ç›´æ¥è·‘ä¼šæŠ¥é”™ï¼Œé‡æ–°å†™ä¸€ä¸ªdockerfileä»¥æ–¹ä¾¿æµ‹è¯•\n1 2 3 4 # æ³¨æ„è¿™é‡Œçš„é•œåƒåç§°ä¸ºä¸Šä¸€æ­¥æ‰€æ‰“é•œåƒ FROM vllm-cpu-env # è¿™é‡Œæ˜¯ä¸ºäº†è¦†ç›–æ‰è€çš„endpointä»¥æ–¹ä¾¿åšæµ‹è¯• ENTRYPOINT tail -f /dev/null æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œæµ‹è¯•ï¼ŒæŒ‡å®šäº† 8000ç«¯å£æš´æ¼ï¼ŒåŒæ—¶å°†ä¸‹è½½çš„æ¨¡å‹æŒ‚è½½åˆ°å®¹å™¨ï¼Œå¹¶æŒ‡å®šå…±äº«å†…å­˜ä¸º4G\ndocker run -d \u0026ndash;name llms -v /root/llmvs/ModelSpace:/workspace/ModelSpace -p 8000:8000 \u0026ndash;shm-size 4g llms:v0.2\næ­£å¼è¿è¡Œ 1 docker run -d --name llms -v /root/llmvs/ModelSpace:/workspace/ModelSpace -p 8000:8000 --shm-size 4g vllm-cpu-env:latest --model /workspace/ModelSpace/Qwen2-0.5B å‚è€ƒé“¾æ¥ï¼šhttps://qwen.readthedocs.io/en/latest/deployment/vllm.html\n1 2 3 4 5 6 7 8 9 10 11 curl -i http://localhost:8080/v1/chat/completions -H \u0026#34;Content-Type: application/json\u0026#34; -d \u0026#39;{ \u0026#34;model\u0026#34;: \u0026#34;/workspace/ModelSpace/Qwen2-0.5B\u0026#34;, \u0026#34;messages\u0026#34;: [ {\u0026#34;role\u0026#34;: \u0026#34;system\u0026#34;, \u0026#34;content\u0026#34;: \u0026#34;ä½ æ˜¯ä¸€åäººå·¥æ™ºèƒ½é¢†åŸŸçš„ä¸“å®¶\u0026#34;}, {\u0026#34;role\u0026#34;: \u0026#34;user\u0026#34;, \u0026#34;content\u0026#34;: \u0026#34;å¦‚ä½•å­¦ä¹ å¤§æ¨¡å‹åº”ç”¨ï¼Ÿ\u0026#34;} ], \u0026#34;temperature\u0026#34;: 0.7, \u0026#34;top_p\u0026#34;: 0.8, \u0026#34;repetition_penalty\u0026#34;: 1.05, \u0026#34;max_tokens\u0026#34;: 300 }\u0026#39; å¦‚æœä»¥ä¸Šè¿‡ç¨‹ä½ éƒ½ä¸æƒ³åšï¼Œå¯ä»¥ç›´æ¥æ‹‰å–æˆ‘æ‰“å¥½çš„cpué•œåƒï¼šregistry.cn-hangzhou.aliyuncs.com/reg_pub/vllm-cpu-env:latest ","date":"2024-09-23T08:38:25Z","permalink":"https://blog.liu-nian.top/ai/vllm-cpu%E6%8E%A8%E7%90%86-%E4%BB%A5qwen2-0.5b%E4%B8%BA%E4%BE%8B/","title":"lvllm-cpuæ¨ç†-ä»¥qwen2-0.5bä¸ºä¾‹"},{"content":"æ‘˜è¦ï¼š æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº†ä½¿ç”¨Hugoæ­å»ºMarkdownåšå®¢çš„è¿‡ç¨‹ï¼ŒåŒ…æ‹¬æœ¬åœ°ç¼–è¾‘ç¯å¢ƒæ­å»ºã€ä¸»é¢˜æ ·å¼ä¿®æ”¹ã€è¿œç¨‹éƒ¨ç½²åŠå›¾åºŠæ­å»ºç­‰æ­¥éª¤ã€‚é€šè¿‡æœ¬åœ°ç¼–è¾‘Markdownæ–‡æ¡£å¹¶é¢„è§ˆï¼ŒæˆåŠŸåå¯æ¨é€è‡³GitHubç§æœ‰ä»“åº“ã€‚Hugoå°†Markdownæ–‡æ¡£æ¸²æŸ“ä¸ºHTMLæ–‡ä»¶ï¼Œå¯åˆ©ç”¨GitHub PagesæœåŠ¡æˆ–VPSä¸­çš„å®¹å™¨å¯¹å¤–æš´éœ²ã€‚åŒæ—¶ï¼Œæ–‡æ¡£è¿˜ä»‹ç»äº†å¦‚ä½•é…ç½®SSH Keyã€å…‹éš†ä¸»é¢˜ä»“åº“ã€ä¿®æ”¹ä¸»é¢˜æ ·å¼ï¼Œä»¥åŠé€šè¿‡GitHub Pagesæˆ–è‡ªå»ºæœåŠ¡å™¨è¿›è¡Œè¿œç¨‹éƒ¨ç½²ï¼Œå¹¶æä¾›äº†åŸºäºGitHubçš„å›¾åºŠæ­å»ºæ–¹æ³•ã€‚\nPowered by ç™¾åº¦Comate\nåŸºæœ¬æ€è·¯ï¼š\nä½¿ç”¨åœ¨æœ¬åœ°ç¼–è¾‘Markdownæ–‡æ¡£ï¼Œå¹¶æµ‹è¯•é¢„è§ˆã€‚æˆåŠŸåæ¨é€åˆ°githubç§æœ‰ä»“åº“ã€‚hugoå¯ä»¥å°†markdownæ–‡æ¡£æ¸²æŸ“ä¸ºhtmlæ–‡ä»¶ã€‚å¯ä»¥ä½¿ç”¨githubçš„pagesæœåŠ¡å¯¹å¤–æš´æ¼ï¼Œä¹Ÿå¯åœ¨vpsä¸­å¯åŠ¨ä¸€ä¸ªå®¹å™¨æ¥å¯¹å¤–æš´æ¼ã€‚\n1. æœ¬åœ°ç¼–è¾‘ç¯å¢ƒæ­å»º 1.1 äºŒè¿›åˆ¶å®‰è£…hugo ç›´æ¥å®‰è£…äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯å‚è€ƒï¼šhttps://github.com/gohugoio/hugo/releases ä¸‹è½½å¯¹åº”ç‰ˆæœ¬å¹¶å®‰è£… ä»¥macå®¢æˆ·ç«¯ä¸ºä¾‹ï¼Œä¸‹è½½å¯¹åº”ç‰ˆæœ¬åè§£å‹åˆ°æŒ‡å®šç›®å½•ã€‚\n1 2 3 4 5 6 7 # æ–‡ä»¶è§£å‹ tar -zxvf hugo_0.143.0_darwin-universal.tar.gz cd hugo_0.143.0_darwin-universal chmod +x hugo mv hugo /usr/local/bin # éªŒè¯æµ‹è¯• hugo version 1.2 æºç å®‰è£…hugo(å¯é€‰) å¦‚éœ€æºç å®‰è£…ï¼Œä»¥macå®¢æˆ·ç«¯ä¸ºä¾‹ï¼Œéœ€è¦å®‰è£…gitã€hugoã€‚\nå®‰è£…git macè‡ªå¸¦gitï¼Œæ— éœ€å®‰è£…ã€‚å¦‚éœ€å®‰è£…æˆ–æ›´æ–°ï¼Œå¯å‚è€ƒï¼šhttps://git-scm.com/downloads/mac\nå®‰è£…go å¯å‚è€ƒé“¾æ¥ï¼šhttps://go.dev/dl/é€‰æ‹©å¯¹åº”ç‰ˆæœ¬çš„hugoï¼Œä¸‹è½½åè§£å‹åˆ°æŒ‡å®šç›®å½•ã€‚\nå®‰è£…hugo go install github.com/gohugoio/hugo@latest\n2. ä¿®æ”¹ä¸»é¢˜æ ·å¼ 2.1 é…ç½®ssh key æ­¤å¤„ä¸ºæœ¬åœ°å¼€å‘ç¯å¢ƒéœ€è¦ï¼Œæ–¹ä¾¿å…å¯†æäº¤æ–‡ä»¶åˆ°gitä»“åº“ã€‚è¿™é‡Œä»¥æäº¤åˆ°githubä»“åº“ä¸ºä¾‹ã€‚å¦‚æœä¸»è¦åœ¨å›½å†…è®¿é—®ï¼Œä¸”æœ‰å¤‡æ¡ˆåŸŸåï¼Œå»ºè®®ä½¿ç”¨giteeæˆ–è‡ªæœ‰gitä»“åº“ã€‚ å¯å‚è€ƒé“¾æ¥ï¼š sshæœ¬åœ°ç§˜é’¥ç”Ÿæˆ\n1 2 3 4 5 6 7 ssh-keygen -t ed25519 -C \u0026#34;your_email@example.com\u0026#34; # é‚®ç®±ä¸ºgithubæ³¨å†Œé‚®ç®±,ä¸€è·¯è¾“å…¥enterå³å¯ # å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ä¸æ”¯æŒ Ed25519 ç®—æ³•çš„æ—§ç³»ç»Ÿï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š # ssh-keygen -t rsa -b 4096 -C \u0026#34;your_email@example.com\u0026#34; # å°† SSH ç§é’¥æ·»åŠ åˆ° ssh-agentã€‚ ssh-add ~/.ssh/id_ed25519 # æŸ¥çœ‹å…¬é’¥å†…å®¹ï¼Œå°†å…¶å¤åˆ¶ cat ~/.ssh/id_ed25519.pub è®¿é—®è‡ªå·±çš„githubè´¦å·ï¼Œåœ¨è´¦å·è®¾ç½®ä¸­æ·»åŠ sshå…¬é’¥ 2.2 å…‹éš†ä¸»é¢˜ä»“åº“åˆ°æœ¬åœ° å°†è‡ªå·±å–œæ¬¢çš„ä¸»é¢˜å…‹éš†åˆ°æœ¬åœ°ï¼Œå’Œhugoä¸€èµ·ä½¿ç”¨ã€‚å› æ¶‰åŠåˆ°å¯¹ä¸»é¢˜çš„æ›´æ”¹å’Œç»´æŠ¤ï¼Œå»ºè®®ä½¿ç”¨git å­æ¨¡å—æ¥ç»´æŠ¤ã€‚å¯ä»¥å°†è¯¥ä¸»é¢˜forkåˆ°è‡ªå·±çš„ç©ºé—´ï¼Œç„¶åå°†è‡ªå·±forkçš„ä¸»é¢˜ä½œä¸ºå­æ¨¡å—æ·»åŠ ã€‚è¿™é‡Œä»¥stackä¸»é¢˜ä¸ºä¾‹ã€‚\n1 2 3 4 5 6 7 8 9 10 # åˆ›å»ºç¬¬ä¸€ä¸ªç«™ç‚¹ hugo new site pages # pages ä¸ºç«™ç‚¹æ–‡ä»¶å¤¹åå­— cd pages git init # æ³¨æ„åˆå§‹åŒ–çš„ç›¸å¯¹ä½ç½® # æ·»åŠ ä¸»é¢˜ï¼Œä»¥stackä¸ºä¾‹ã€‚æ³¨æ„githubä»“åº“åœ°å€ä¸è¦ä½¿ç”¨httpsåè®®çš„ï¼Œå¦åˆ™ä¼šå‡ºç°å­æ¨¡å—çš„æ›´æ”¹æ— æ³•æäº¤çš„æƒ…å†µ git submodule add --name stack git@github.com:Williamyzd/hugo-theme-stack.git themes/stack # æ·»åŠ ä¸€ä¸ªæµ‹è¯•é¡µé¢ hugo new content content/posts/my-first-post.md echo \u0026#34;hello,word!\u0026#34; \u0026gt;\u0026gt; content/posts/my-first-post.md hugo server -D -p 8000 # å¯æŸ¥çœ‹å¤„äºè‰ç¨¿çŠ¶æ€ä¸‹çš„æ–‡æ¡£å†…å®¹ -p åˆ¶å®šå¯å¯¹å¤–æš´æ¼ç«¯å£ï¼Œé»˜è®¤æ˜¯1314 æµè§ˆå™¨è®¿é—®é¡µé¢ï¼šhttp://localhost:8000/posts/my-first-post/ï¼Œå¯çœ‹åˆ°å‘å¸ƒå†…å®¹ 2.3 ä¿®æ”¹ä¸»é¢˜æ ·å¼ ä¿®æ”¹ä¸»é¢˜æ ·å¼ï¼Œä¸»è¦åœ¨hugo.toml(yaml)æ–‡ä»¶ä¸­ï¼Œæˆ–è€…åœ¨ä¸»é¢˜æ–‡ä»¶å¤¹ä¸­ä¿®æ”¹ã€‚å¯å°†themes/stack/exampleSite/hugo.yaml å¤åˆ¶åˆ°ç«™ç‚¹æ ¹ç›®å½•ï¼Œå¹¶ä¿®æ”¹ä¸ºè‡ªå·±çš„é…ç½®ã€‚\nparams-sidebar-avatarä¿®æ”¹logo params-mainSections æŒ‡å®šä¸»é¡µé»˜è®¤è·å–çš„æœ€æ–°æ–‡ç«  menu-main æŒ‡å®šå¯¼èˆªæ¨¡å— menu-social æŒ‡å®šç¤¾äº¤æ¨¡å— 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 baseurl: https://example.com/ languageCode: en-us # ä¸»é¢˜åç§°ï¼Œæ³¨æ„è¦å’Œå­æ¨¡å—çš„æ–‡ä»¶å¤¹åä¸€è‡´ theme: stack # ç½‘ç«™æ ‡é¢˜ title: Example Site # ç‰ˆæƒä¿¡æ¯ copyright: Example Person # å¤šè¯­è¨€æ”¯æŒç›¸å…³ # Theme i18n support # Available values: ar, bn, ca, de, el, en, es, fr, hu, id, it, ja, ko, nl, pt-br, th, uk, zh-cn, zh-hk, zh-tw DefaultContentLanguage: en # Set hasCJKLanguage to true if DefaultContentLanguage is in [zh-cn ja ko] # This will make .Summary and .WordCount behave correctly for CJK languages. hasCJKLanguage: false languages: en: languageName: English title: Example Site weight: 1 params: sidebar: subtitle: Example description zh-cn: languageName: ä¸­æ–‡ title: æ¼”ç¤ºç«™ç‚¹ weight: 2 params: sidebar: subtitle: æ¼”ç¤ºè¯´æ˜ pagination: pagerSize: 3 permalinks: post: /p/:slug/ page: /:slug/ params: # è¿™ä¸ªå‚æ•°æ¯”è¾ƒå…³é”®ï¼Œå†³å®šä¸»é¡µå›å»å“ªäº›ç›®å½•ä¸‹å»å–æœ€æ–°çš„æ–‡ç« æ¥æ˜¾ç¤º mainSections: - ai - cs - ops - tools featuredImageField: image rssFullContent: true favicon: # e.g.: favicon placed in `static/favicon.ico` of your site folder, then set this field to `/favicon.ico` (`/` is necessary) footer: since: 2020 customText: dateFormat: published: Jan 02, 2006 lastUpdated: Jan 02, 2006 15:04 MST sidebar: emoji: ğŸ¥ subtitle: Lorem ipsum dolor sit amet, consectetur adipiscing elit. avatar: enabled: true local: true src: img/avatar.png # logoå­˜æ”¾çš„ä½ç½®ï¼Œåœ¨`static/img/`ä¸‹ article: math: false toc: true readingTime: true license: enabled: true default: Licensed under CC BY-NC-SA 4.0 # æ˜¯å¦å¼€å¯è¯„è®ºï¼Œå»ºè®®ä¸å¼€ comments: enabled: false provider: disqus # é»˜è®¤ä¼šå¼€å¯çš„å‡ ä¸ªç»„ä»¶ï¼šæœç´¢ã€å½’æ¡£ã€åˆ†ç±»ã€æ ‡ç­¾äº‘ widgets: homepage: - type: search - type: archives params: limit: 5 - type: categories params: limit: 10 - type: tag-cloud params: limit: 10 page: - type: toc opengraph: twitter: # Your Twitter username site: # Available values: summary, summary_large_image card: summary_large_image defaultImage: opengraph: enabled: false local: false src: colorScheme: # Display toggle toggle: true # Available values: auto, light, dark default: auto imageProcessing: cover: enabled: true content: enabled: true ### Custom menu ### See https://stack.jimmycai.com/config/menu ### To remove about, archive and search page menu item, remove `menu` field from their FrontMatter # è‡ªå®šä¹‰çš„èœå•é¡¹ menu: main: - identifier: ai #æ ‡è¯†ç¬¦ï¼Œå”¯ä¸€å€¼ name: AI # æ˜¾ç¤ºçš„åç§° url: /ai # æ–‡ä»¶è·¯å¾„ï¼Œç›¸å¯¹äºcontentæ–‡ä»¶å¤¹ weight: -90 #æƒé‡ #æƒé‡è¶Šå°ï¼Œè¶Šé å‰æ˜¾ç¤º params: ### For demonstration purpose, the home link will be open in a new tab newTab: false #æ˜¯å¦æ–°å¼€æ ‡ç­¾é¡µ icon: ai # å›¾æ ‡ä¿¡æ¯ï¼ŒæŸ¥çœ‹å’Œè‡ªå®šä¹‰å›¾æ ‡ï¼Œå¯ä¿®æ”¹ themes/stack/assets/icons ä¸‹çš„æ–‡ä»¶ï¼Œå°†æ–‡ä»¶åå†™åœ¨è¿™é‡Œ - identifier: ops name: è¿ç»´\u0026amp;å·¥å…· url: /ops weight: -90 #æƒé‡ params: ### For demonstration purpose, the home link will be open in a new tab newTab: false icon: ops #æ›´å¤šçš„å›¾æ ‡ä¿¡æ¯è§å - identifier: cs name: CSåŸºç¡€ url: /cs weight: -90 #æƒé‡ params: ### For demonstration purpose, the home link will be open in a new tab newTab: true icon: cs #æ›´å¤šçš„å›¾æ ‡ä¿¡æ¯è§å social: - identifier: github name: GitHub url: https://github.com/CaiJimmy/hugo-theme-stack params: icon: brand-github - identifier: twitter name: Twitter url: https://twitter.com params: icon: brand-twitter related: includeNewer: true threshold: 60 toLower: false indices: - name: tags weight: 100 - name: categories weight: 200 markup: goldmark: extensions: passthrough: enable: true delimiters: block: - - \\[ - \\] - - $$ - $$ inline: - - \\( - \\) renderer: ## Set to true if you have HTML content inside Markdown unsafe: true tableOfContents: endLevel: 4 ordered: true startLevel: 2 highlight: noClasses: false codeFences: true guessSyntax: true lineNoStart: 1 lineNos: true lineNumbersInTable: true tabWidth: 4 ç°åœ¨å¯ä»¥åœ¨contentç›®å½•ä¸‹åˆ›å»ºæ–‡æ¡£äº†ã€‚ æœ€ç»ˆæ•ˆæœå¦‚ä¸‹ï¼š 3. è¿œç¨‹éƒ¨ç½² hugo ç”Ÿæˆçš„é™æ€htmlæ–‡ä»¶åœ¨publicç›®å½•ä¸‹ï¼Œå¯ä»¥è€ƒè™‘å•ç‹¬åˆ›å»ºä¸€ä¸ªä»“åº“æ¥ç®¡ç†ï¼Œåœ¨ä¸»gitä»“åº“ä¸‹å†å»ºä¸€ä¸ªå­æ¨¡å—ã€‚\n3.1 æ·»åŠ é™æ€æ–‡ä»¶å­æ¨¡å— æ·»åŠ å­æ¨¡å—ä¸»è¦ä½¿ç”¨å‘½ä»¤å¦‚ä¸‹ï¼š\næ–°å»ºè¿œç¨‹ä»“åº“ï¼šgit@github.com:Williamyzd/blogs-html.git åœ¨ä¸»ä»“åº“ä¸‹æ·»åŠ å­æ¨¡å—ï¼š 1 git submodule add -n pub-html git@github.com:Williamyzd/blogs-html.git blog/public å¦‚æœ å­æ¨¡å—æ·»åŠ é”™è¯¯ï¼Œå¯ç”¨å¦‚ä¸‹å‘½ä»¤åˆ é™¤ï¼š\n1 2 3 git rm --cached pub-html # pub-html:å­æ¨¡å—åç§° rm -rf blog/public # åˆ é™¤æœ¬åœ°æ–‡ä»¶å¤¹ vim .gitmodules # åˆ é™¤.gitmodulesæ–‡ä»¶ä¸­çš„å­æ¨¡å—ä¿¡æ¯ 3.2 è¿œç¨‹æœåŠ¡å™¨éƒ¨ç½²(å¯é€‰) åˆ›å»ºDockerfileæ–‡ä»¶ï¼Œå‚è€ƒå¦‚ä¸‹ï¼š å¦‚æ— æœåŠ¡å™¨å¯ç”¨ï¼Œå¯ä»¥ä¸è€ƒè™‘è¿™ä¸€æ­¥ã€‚ é€šè¿‡vpsï¼ˆæœåŠ¡å™¨ï¼‰æ‰˜ç®¡ä¸€ä¸ªnginxæœåŠ¡ã€‚dockerfileå‚è€ƒï¼š 1 2 3 4 5 6 7 8 9 10 11 12 FROM nginx:1.27.3-alpine WORKDIR /home COPY blog.conf /etc/nginx/conf.d/default.conf # å‡†å¤‡è¯ä¹¦,å¦‚æœ‰å¯æ‰“å¼€ # COPY cert /etc/nginx/cert RUN apk update \u0026amp;\u0026amp; apk add git \u0026amp;\u0026amp; \\ git clone https://github.com/Williamyzd/blogs-html.git /home/public \u0026amp;\u0026amp; \\ echo \u0026#34;echo \\$(date +%Y-%m-%d) \\$(date +%H:%M:%S) [info]: \\$(cd /home/public \u0026amp;\u0026amp; git pull) \u0026gt;\u0026gt; /var/log/blog/\\$(date +%Y-%m-%d).log\u0026#34; \u0026gt;\u0026gt; /home/blog.sh \u0026amp;\u0026amp; \\ chmod +x /home/blog.sh \u0026amp;\u0026amp; \\ mkdir -p /var/log/blog \u0026amp;\u0026amp; \\ echo \u0026#34;*/1 * * * * /home/blog.sh\u0026#34; \u0026gt;\u0026gt; /etc/crontabs/root CMD crond \u0026amp;\u0026amp; nginx \u0026amp;\u0026amp; tail -f /dev/null Dockerfile å†…å®¹è¯´æ˜ï¼š è¿™é‡Œä½¿ç”¨äº†æ›´åŠ è½»é‡ç‰ˆçš„alpineç‰ˆæœ¬nginxï¼Œå¹¶å®‰è£…äº†gitã€‚è¿™ä¸ªé•œåƒæœ¬èº«å…·å¤‡å®šæ—¶åŠŸèƒ½ï¼Œåˆ›å»ºäº†ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯å¤©æ‰§è¡Œä¸€æ¬¡git pullå‘½ä»¤ã€‚å› ä»“åº“æ˜¯åªè¯»ä¸”å¯¹å¤–å…¬å¼€ï¼Œæ‰€ä»¥è¿™é‡Œä¸éœ€è¦è®¤è¯ã€‚æœ€åçš„å¯åŠ¨å‘½ä»¤æ˜¯å…ˆå¯åŠ¨å®šæ—¶ä»»åŠ¡ï¼Œå†å¯åŠ¨nginxæœåŠ¡ã€‚åŒæ—¶ä¿ç•™ä¸€ä¸ªä¸»è¿›ç¨‹ï¼Œä¿è¯å®¹å™¨ä¸ä¼šé€€å‡ºã€‚ nginxé…ç½®æ–‡ä»¶å‚è€ƒï¼š blog.confå‚è€ƒ(æœªåŒ…å«httpsé…ç½®)ï¼š 1 2 3 4 5 6 7 8 server { listen 80; server_name blog.xxx.com; location / { root /home/public; index index.html index.htm; } } sslé…ç½®çš„ä¾‹å­,éœ€è¦æå‰å‡†å¤‡ä¸‹è¯ä¹¦ï¼Œå¹¶å°†dockerfile ä¸­çš„æ³¨é‡Šå»æ‰ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 # ä»¥ä¸‹å±æ€§ä¸­ä»¥sslå¼€å¤´çš„å±æ€§ä»£è¡¨ä¸è¯ä¹¦é…ç½®æœ‰å…³ï¼Œå…¶ä»–å±æ€§è¯·æ ¹æ®è‡ªå·±çš„éœ€è¦è¿›è¡Œé…ç½®ã€‚ server { listen 80; # éœ€è¦è°ƒæ•´ä¸ºæ‚¨è¯ä¹¦ç»‘å®šçš„åŸŸåã€‚ server_name blog.xxx.com return 301 https://$host/$request_uri; } server { listen 443 ssl; server_name blog.xxx.com; # localhostä¿®æ”¹ä¸ºæ‚¨è¯ä¹¦ç»‘å®šçš„åŸŸåã€‚ ssl_certificate /etc/nginx/cert/domain_ca.crt; # å°†domain_ca.crtæ›¿æ¢æˆæ‚¨è¯ä¹¦é“¾çš„æ–‡ä»¶å(å¦‚ä¸‹è½½æ–‡ä»¶æ²¡æœ‰domain_ca.crtåˆ™ä½¿ç”¨domain.crtæˆ–domain.pem)ã€‚ ssl_certificate_key /etc/nginx/cert/domain.key; # å°†domain.keyæ›¿æ¢æˆæ‚¨è¯ä¹¦çš„å¯†é’¥æ–‡ä»¶åã€‚ ssl_session_timeout 5m; # æŒ‡å®šSSL/TLSä¼šè¯çš„è¶…æ—¶æ—¶é—´ ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4; #ä½¿ç”¨æ­¤åŠ å¯†å¥—ä»¶ã€‚ ssl_protocols TLSv1 TLSv1.1 TLSv1.2; #ä½¿ç”¨è¯¥åè®®è¿›è¡Œé…ç½®ã€‚ ssl_prefer_server_ciphers on; location / { root /home/public; #ç«™ç‚¹ç›®å½•ã€‚ index index.html index.htm; } }\tåˆ›å»ºdocker-compose.ymlæ–‡ä»¶ï¼Œå‚è€ƒå¦‚ä¸‹ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 version: \u0026#39;3\u0026#39; services: blog: build: context: . dockerfile: Dockerfile image: blog:v1.0 container_name: blog restart: always ports: - \u0026#34;80:80\u0026#34; - \u0026#34;443:443\u0026#34; æ„å»ºå¹¶å¯åŠ¨å®¹å™¨ï¼š å°†sslè¯ä¹¦ï¼ˆå¯é€‰ï¼‰ã€blog.confã€Dockerfileã€Dockerfileæ–‡ä»¶æ”¾åˆ°åŒä¸€ç›®å½•ä¸‹ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # ä¸€é”®æ„å»ºå¹¶å¯åŠ¨è„šæœ¬ docker-compose up -d # å¦‚æœé•œåƒç‰ˆæœ¬ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨æ„å»ºé•œåƒï¼Œç„¶åå¯åŠ¨é•œåƒ # å¦‚éœ€åœ¨å¯åŠ¨æ—¶ï¼Œéƒ½é‡æ–°æ„å»ºé•œåƒå¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ docker-compose up -d --build # å•ç‹¬æ„å»ºé•œåƒå¹¶å¯åŠ¨å®¹å™¨ # å¦‚å½“å‰æ“ä½œç¯å¢ƒçš„æ¶æ„ä¸ç›®æ ‡æœºå™¨çš„æ¶æ„ä¸åŒï¼Œå¯ä»¥æ„å»ºé•œåƒï¼Œå¹¶æŒ‡å®šæ“ä½œç³»ç»Ÿæ¶æ„ï¼Œå¦‚ï¼š docker build --platform linux/amd64,linux/arm64 -t blog:v1.0 . docker compose up -d # åœæ­¢è„šæœ¬ docker-compose down 3.3 ä½¿ç”¨github pagesæ‰˜ç®¡ 3.2 è‡ªå»ºå®¹å™¨çš„æ–¹å¼éƒ¨ç½²ï¼Œéœ€è¦è‡ªå¤‡æœåŠ¡å™¨ã€åŸŸåç­‰ï¼Œæˆæœ¬è¾ƒé«˜ã€‚ä¸å…·å¤‡æ¡ä»¶æˆ–è€…æƒ³èŠ‚çº¦æˆæœ¬ï¼Œå¯ä»¥è€ƒè™‘ç™½å«–githubï¼Œä½¿ç”¨github pagesæ‰˜ç®¡é™æ€æ–‡ä»¶ã€‚åªéœ€è¦ä¸€äº›ç®€å•çš„é…ç½®å³å¯ã€‚ ä¸Šæ–‡æˆ‘ä»¬å·²ç»åˆ›å»ºäº†htmlæ–‡ä»¶çš„ä»“åº“ï¼šhttps://github.com/Williamyzd/blogs-html.git æˆ‘ä»¬åªéœ€è¦åœ¨ä»“åº“çš„è®¾ç½®ä¸­ï¼Œå¼€å¯github pagesåŠŸèƒ½å³å¯ã€‚\nè¿›å…¥ä»“åº“è®¾ç½®é¡µé¢ï¼Œé€‰æ‹©pagesé€‰é¡¹å¡ åœ¨Sourceä¸­é€‰æ‹©mainåˆ†æ”¯ï¼Œå¹¶é€‰æ‹©/ï¼ˆæ ¹ç›®å½•ï¼‰ ç¨ç­‰ç‰‡åˆ»ï¼Œå³å¯é€šè¿‡åŸŸåè®¿é—®äº†ã€‚ å…¶ä¸­çš„è‡ªå®šä¹‰åŸŸåï¼ˆæ ‡çº¢çš„3ï¼‰ï¼Œéœ€è¦æœ‰è‡ªå·±çš„åŸŸåï¼Œå¹¶åœ¨åŸŸåè§£æä¸­æ·»åŠ ä¸€æ¡è§£æè®°å½•ï¼ŒæŒ‡å‘github pagesæä¾›çš„åŸŸåã€‚å¦‚æœ¬ä¾‹ä¸­ï¼ŒåŸŸåpages.liu-nian.topéœ€è¦æ·»åŠ çš„è®°å½•æ˜¯ï¼šwilliamyzd.github.ioã€‚å…¶æ¨¡å¼ä¸º[githubç”¨æˆ·å].github.ioã€‚å½“å‰åŸŸååœ¨ç™¾åº¦æ™ºèƒ½äº‘æ‰˜ç®¡ï¼Œå…¶æ·»åŠ è®°å½•å¦‚ä¸‹ï¼š è‡³æ­¤å¯ä»¥æ„‰å¿«åœ°è®¿é—®è‡ªå·±çš„åšå®¢äº†ã€‚\n4. å›¾åºŠæ­å»º-åŸºäºgithub æœ¬äººä¸»è¦ä½¿ç”¨vscodeæ’°å†™åšå®¢ï¼Œvscodeæœ‰ä¸°å¯Œçš„æ’ä»¶ã€‚å…³äºmarkdownç›¸å…³çš„ï¼Œå½“å‰ä½¿ç”¨åˆ°çš„å¦‚ä¸‹ï¼š åœ¨åšå®¢æ’°å†™è¿‡ç¨‹ä¸­,ä¸å…è¦å¤åˆ¶ã€ç²˜è´´å›¾ç‰‡ï¼Œå¦‚æœç›´æ¥ä¸Šä¼ åˆ°åšå®¢ä¸­ï¼Œæ¶‰åŠåˆ°å›¾ç‰‡å­˜å‚¨ä¸ºæ­¢çš„è€ƒè™‘ã€‚è€Œhuogoä¸­å¦‚æœæƒ³åœ¨ç¼–å†™å’Œæœ€ç»ˆç”Ÿäº§ç¯å¢ƒä¸­èƒ½å¤Ÿå±•ç¤ºå›¾ç‰‡ï¼Œæ¶‰åŠåˆ°å‡ å¤„å¤æ‚é…ç½®ã€‚åšè¿‡å‡ æ¬¡å°è¯•ä¾¿æ”¾å¼ƒäº†ã€‚åšä¸»ä¹‹å‰ä½¿ç”¨è¿‡picgoç­‰å›¾åºŠå·¥å…·ï¼Œå¯ä»¥ç›´æ¥å°†å¤åˆ¶çš„å›¾ç‰‡ä¸Šä¼ åˆ°å¯¹åº”çš„æ–‡ä»¶æœåŠ¡å™¨ï¼ŒåŒæ—¶ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶çš„é“¾æ¥ï¼Œç›´æ¥æ’å…¥æ–‡æ¡£å³å¯ã€‚å¯æƒœpicgoå·²ç»åœæ­¢ç»´æŠ¤äº†ã€‚å¸¸è§çš„å›¾åºŠå¸¸è§çš„æ‰˜ç®¡æ–¹å¦‚ä¸ƒç‰›ã€å¾®åšã€è…¾è®¯äº‘ã€é˜¿é‡Œäº‘ç­‰æ˜¯å…è´¹çš„æˆ–ä¸€å®šé™é¢çš„å…è´¹ã€‚å¤„äºä¸æ„¿å—åˆ¶ä¸äººçš„è€ƒé‡ï¼Œè¿™é‡Œè€ƒè™‘ä½¿ç”¨githubæ­å»ºä¸€ä¸ªè‡ªå·±çš„å›¾åºŠã€‚\n4.1 åˆ›å»ºä»“åº“ é€‰æ‹©åˆ›å»ºä¸€ä¸ªå…¬å¼€çš„ä»“åº“ï¼Œç”¨äºå­˜æ”¾å›¾ç‰‡ã€‚ è¿›å…¥è®¾ç½®ä¸­ï¼Œåˆ›å»ºtokenï¼Œç”¨äºæ’ä»¶ä¸Šä¼ å›¾ç‰‡æ—¶ä½¿ç”¨ã€‚å¯ç›´æ¥ç‚¹å‡»é“¾æ¥é…ç½®ï¼šhttps://github.com/settings/personal-access-tokens githubçš„å¼€å‘è€…tokenå¯ç”¨apiçš„æ–¹å¼å¯¹gitä»“åº“ã€è´¦å·è¿›è¡Œæ§åˆ¶ã€‚tokenåˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯è´¦å·çº§æƒé™æ§åˆ¶ï¼Œå¦å¤–ä¸€ç§æ˜¯é¡¹ç›®çº§åˆ«çš„æ§åˆ¶ã€‚å»ºè®®é€‰ç”¨é¡¹ç›®çº§åˆ«æ§åˆ¶çš„ fine-grained personal tokenã€‚ çº¢æ¡†éƒ¨åˆ†æ³¨æ„å¡«å†™ï¼Œå…¶ä¸­è¿‡æœŸæ—¶é—´æ ¹æ®è‡ªå·±éœ€è¦å¡«å†™ã€‚ æ³¨æ„é€‰ä¸­repoæƒé™ï¼Œå‹¾é€‰repoçš„å†™å…¥æƒé™ã€‚ åˆ›å»ºåé¡µé¢ä¼šæ˜¾ç¤ºtokenä¿¡æ¯ï¼Œè¿›è¡Œå¤åˆ¶ä¿å­˜ï¼Œåœ¨åç»­æ’ä»¶é…ç½®æ—¶ä½¿ç”¨ã€‚ 4.2 å®‰è£…vscodeæ’ä»¶ è¿™é‡Œä½¿ç”¨markdown-imageæ’ä»¶ï¼Œå®‰è£…åé…ç½®å¦‚ä¸‹ï¼š\nbase é…ç½®ï¼Œä¸»è¦æ˜¯é€‰githubä¸ºé»˜è®¤å­˜å‚¨æ–¹å¼ã€è§„å®šå›¾ç‰‡å­˜å‚¨çš„æ ¼å¼ç­‰ï¼Œå…¶ä»–å†…å®¹é…Œæƒ…è®¾ç½® File Name Format è¿™ä¸ªé€‰é¡¹æ¯”è¾ƒå…³é”®ï¼Œå»ºè®®ä½¿ç”¨å¹´æœˆæ–¹å¼åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œå½“æœˆçš„æ–‡ä»¶æ”¾åœ¨ä¸€èµ·ï¼Œä»¥é˜²æ­¢æ–‡ä»¶è¿‡å¤šï¼Œå¯¼è‡´githubä»“åº“ç®¡ç†éº»çƒ¦è´§åŠ è½½ç¼“æ…¢ã€‚ githubé…ç½®ï¼Œä¸»è¦æ˜¯å¡«å†™ä»“åº“åœ°å€ã€tokenç­‰ä¿¡æ¯ã€‚tokenä¿¡æ¯æ¥æºäºgithubè´¦å·ä¸­ç”Ÿæˆçš„tokenã€‚ è‡³æ­¤ï¼Œå›¾ç‰‡ä¸Šä¼ é…ç½®å®Œæˆã€‚ å‚è€ƒé“¾æ¥ï¼š\nå›¾æ ‡ç”Ÿæˆï¼šhttps://www.iconfont.cn/search/index åšå®¢æ­å»ºï¼šhttps://gohugo.io/getting-started/quick-start/ sshè®¾ç½®ï¼šhttps://docs.github.com/zh/authentication/connecting-to-github-with-ssh/adding-a-new-ssh-key-to-your-github-account åšå®¢è®¾ç½®å‚è€ƒï¼šhttps://yidude.com/html/15.html ","date":"2024-05-16T02:54:56+08:00","permalink":"https://blog.liu-nian.top/ops/%E6%90%AD%E5%BB%BAhugo%E5%8D%9A%E5%AE%A2/","title":"æ­å»ºMarkdownåšå®¢--åŸºäºhugo"},{"content":"æ‘˜è¦: æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†Linux Volume Manager (LVM) çš„ç›¸å…³å‘½ä»¤ï¼ŒåŒ…æ‹¬ç£ç›˜åˆ†åŒºã€ç‰©ç†å·åˆ›å»ºã€å·ç»„ç®¡ç†ã€é€»è¾‘å·åˆ›å»ºä¸ç®¡ç†ã€æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ä¸è‡ªåŠ¨æŒ‚è½½ç­‰æ­¥éª¤ã€‚LVM æ˜¯ä¸€ç§é€»è¾‘å·ç®¡ç†æŠ€æœ¯ï¼Œå…è®¸ç”¨æˆ·åœ¨ç‰©ç†ç£ç›˜ä¸Šåˆ›å»ºã€æ‰©å±•ã€ç¼©å‡å’Œç§»åŠ¨åˆ†åŒºï¼Œè€Œä¸å¿…é‡æ–°åˆ†åŒºæˆ–é‡æ–°æ ¼å¼åŒ–ç£ç›˜ã€‚é€šè¿‡LVMï¼Œå¯ä»¥æ›´çµæ´»åœ°ç®¡ç†å­˜å‚¨ç©ºé—´ï¼Œæé«˜å­˜å‚¨åˆ©ç”¨ç‡å’Œçµæ´»æ€§ã€‚\nå‚è€ƒé“¾æ¥ï¼šhttps://support.huaweicloud.com/bestpractice-evs/evs_02_0002.html\nç£ç›˜åˆ†åŒº æ–°æŒ‚è½½ç¡¬ç›˜æˆ–è€…æ‰©å……ç¡¬ç›˜\npartedç›¸å…³å‘½ä»¤ æŒ‰ç…§å¦‚ä¸‹å‘½ä»¤å»ºç«‹åˆ†åŒºã€æ–‡ä»¶ç³»ç»Ÿæ ¼å¼ã€æ‰“ä¸Šlvmæ ‡ç­¾\n1 2 3 4 5 6 7 8 9 lsblk # æŸ¥çœ‹æŒ‚è½½ç£ç›˜ parted /dev/vdd # å›è½¦åæŒ‰ç…§ä»¥ä¸‹æ“ä½œï¼š mklabel gpt # å¤§äº2Tä»¥ä¸Šç£ç›˜ä½¿ç”¨è¯¥æ ¼å¼ mkpart p1 ext4 0 100GB # p1 åˆ†åŒºåç§°,ext4 æ–‡ä»¶ç³»ç»Ÿæ ¼å¼ 0 èµ·å§‹ä½ç½®ï¼ˆç™¾åˆ†æ¯”oræ•°å­—ï¼‰ï¼Œ100GBç»“æŸä½ç½®ï¼ˆç™¾åˆ†æ¯”oræ•°å­—ï¼‰ print #æŸ¥çœ‹åˆ†åŒºç»“æœ toggle 3 lvm # 3 æ–°åˆ›å»ºåˆ†åŒºçš„ç¼–å·ï¼Œlvm æ ‡ç­¾ï¼Œä»è€Œå¯ä»¥ä½¿ç”¨lvmæ¥ç®¡ç† quit # é€€å‡ºpartedå‘½ä»¤ lsblk #æŸ¥çœ‹åˆ†åŒºæƒ…å†µ é€šè¿‡æ–°å¢ç£ç›˜æ¥åˆ›å»ºç‰©ç†å· pvcreate /dev/vdd3\nç‰©ç†å· æŸ¥çœ‹ç£ç›˜ 1 2 3 fdisk -l | grep /dev/vd | grep -v vda Disk /dev/vdb: 10.7 GB, 10737418240 bytes, 20971520 sectors Disk /dev/vdc: 10.7 GB, 10737418240 bytes, 20971520 sectors æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°†äº‘ç¡¬ç›˜åˆ›å»ºä¸ºç‰©ç†å·ã€‚ pvcreate ç£ç›˜è®¾å¤‡å1 ç£ç›˜è®¾å¤‡å2 ç£ç›˜è®¾å¤‡å3\nå‚æ•°è¯´æ˜å¦‚ä¸‹ï¼š\nç£ç›˜è®¾å¤‡åï¼šæ­¤å¤„éœ€è¦å¡«å†™ç£ç›˜çš„è®¾å¤‡åç§°ï¼Œå¦‚æœéœ€è¦æ‰¹é‡åˆ›å»ºï¼Œå¯ä»¥å¡«å†™å¤šä¸ªè®¾å¤‡åç§°ï¼Œä¸­é—´ä»¥ç©ºæ ¼é—´éš”ã€‚\nå‘½ä»¤ç¤ºä¾‹:\npvcreate /dev/vdb /dev/vdc\n1 2 3 pvcreate /dev/vdb /dev/vdc Physical volume \u0026#34;/dev/vdb\u0026#34; successfully created. Physical volume \u0026#34;/dev/vdc\u0026#34; successfully created. æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹ç³»ç»Ÿä¸­ç‰©ç†å·çš„è¯¦ç»†ä¿¡æ¯ã€‚ pvdisplay\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 pvdisplay \u0026#34;/dev/vdc\u0026#34; is a new physical volume of \u0026#34;10.00 GiB\u0026#34; --- NEW Physical volume --- PV Name /dev/vdc VG Name PV Size 10.00 GiB Allocatable NO PE Size 0 Total PE 0 Free PE 0 Allocated PE 0 PV UUID dypyLh-xjIj-PvG3-jD0j-yup5-O7SI-462R7C \u0026#34;/dev/vdb\u0026#34; is a new physical volume of \u0026#34;10.00 GiB\u0026#34; --- NEW Physical volume --- PV Name /dev/vdb VG Name PV Size 10.00 GiB Allocatable NO PE Size 0 Total PE 0 Free PE 0 Allocated PE 0 PV UUID srv5H1-tgLu-GRTl-Vns8-GfNK-jtHk-Ag4HHB å·ç»„ åˆ›å»ºå·ç»„ æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œåˆ›å»ºå·ç»„ã€‚ vgcreate å·ç»„å ç‰©ç†å·åç§°1 ç‰©ç†å·åç§°2 ç‰©ç†å·åç§°3\u0026hellip;\nå‚æ•°è¯´æ˜å¦‚ä¸‹ï¼š\nâ€‹\tå·ç»„åï¼šå¯è‡ªå®šä¹‰ï¼Œæ­¤å¤„ä»¥vgdataä¸ºä¾‹ã€‚\nâ€‹\tç‰©ç†å·åç§°ï¼šæ­¤å¤„éœ€è¦å¡«å†™å¾…æ·»åŠ è¿›å·ç»„çš„æ‰€æœ‰ç‰©ç†å·åç§°ï¼Œä¸­é—´ä»¥ç©ºæ ¼éš”å¼€ã€‚\nå‘½ä»¤ç¤ºä¾‹:\nvgcreate vgdata /dev/vdb /dev/vdc\nå›æ˜¾ç±»ä¼¼å¦‚ä¸‹ä¿¡æ¯ï¼š\n1 2 vgcreate vgdata /dev/vdb /dev/vdc Volume group \u0026#34;vgdata\u0026#34; successfully created æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹ç³»ç»Ÿä¸­å·ç»„çš„è¯¦ç»†ä¿¡æ¯ã€‚ vgdisplay\nå·ç»„æ‰©/ç¼©å®¹ æŸ¥çœ‹ç£ç›˜ï¼Œå¹¶å¦‚åˆ›å»ºç‰©ç†å·\nfdisk -l | grep /dev/vd | grep -v vda\npvcreate ç£ç›˜**è®¾å¤‡å\næ·»åŠ æ–°çš„ç‰©ç†å·\nvgextend å·ç»„åç§° ç‰©ç†å·åç§°\nå‘½ä»¤ç¤ºä¾‹:\nvgextend vgdata /dev/vdd\nåˆ é™¤ç‰©ç†å·\nvgreduce å·ç»„åç§° ç‰©ç†å·åç§°\nå‘½ä»¤ç¤ºä¾‹:\nvgreduce vgdata /dev/vdd\né€»è¾‘å· åˆ›å»ºé€»è¾‘å· lvcreate** -L é€»è¾‘å·å¤§å° -n é€»è¾‘å·åç§° å·ç»„åç§° å‚æ•°è¯´æ˜å¦‚ä¸‹ï¼š\né€»è¾‘å·å¤§å°ï¼šè¯¥å€¼åº”å°äºå·ç»„å‰©ä½™å¯ç”¨ç©ºé—´å¤§å°ï¼Œå•ä½å¯ä»¥é€‰æ‹©â€œMBâ€æˆ–â€œGBâ€ã€‚\né€»è¾‘å·åç§°ï¼šå¯è‡ªå®šä¹‰ï¼Œæ­¤å¤„ä»¥lvdata1ä¸ºä¾‹ã€‚\nå·ç»„åç§°ï¼šæ­¤å¤„éœ€è¦å¡«å†™é€»è¾‘å·æ‰€åœ¨çš„å·ç»„åç§°ã€‚\nå‘½ä»¤ç¤ºä¾‹:\nlvcreate -L 15GB -n lvdata1 vgdata\n1 2 lvcreate -L 15GB -n lvdata1 vgdata Logical volume \u0026#34;lvdata1\u0026#34; created. æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼ŒæŸ¥è¯¢ç³»ç»Ÿä¸­é€»è¾‘å·çš„è¯¦ç»†ä¿¡æ¯ã€‚\nlvdisplay\næ‰©å……é€»è¾‘å· æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œæ‰©å±•é€»è¾‘å·çš„å®¹é‡ã€‚ lvextend -L +å¢åŠ å®¹é‡ é€»è¾‘å·è·¯å¾„\nå‚æ•°è¯´æ˜å¦‚ä¸‹ï¼š\nå¢åŠ å®¹é‡ï¼šè¯¥å€¼åº”å°äºç»„å·å‰©ä½™å¯ç”¨ç©ºé—´å¤§å°ï¼Œå•ä½å¯ä»¥é€‰æ‹©â€œMBâ€æˆ–â€œGBâ€ã€‚\né€»è¾‘å·è·¯å¾„ï¼šæ­¤å¤„éœ€è¦å¡«å†™å¾…æ‰©å®¹çš„é€»è¾‘å·çš„è·¯å¾„ã€‚\nå‘½ä»¤ç¤ºä¾‹: lvextend -L +4GB /dev/vgdata/lvdata1\nå›æ˜¾ç±»ä¼¼å¦‚ä¸‹ä¿¡æ¯ï¼š\n1 2 lvextend -L +4GB /dev/vgdata/lvdata1 Size of logical volume vgdata/lvdata1 changed from 15.00 GiB (3840 extents) to 19.00 GiB (4864 extents). Logical volume vgdata/lvdata1 successfully resized. æ­¤æ—¶åªæ˜¯æ‰©å±•çš„é€»è¾‘å·çš„å®¹é‡ï¼Œåœ¨å…¶ä¹‹ä¸Šçš„æ–‡ä»¶ç³»ç»Ÿä¹Ÿè¦éšä¹‹è¿›è¡Œæ‰©å±•æ‰èƒ½ä½¿ç”¨ã€‚\næ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œæ‰©å±•æ–‡ä»¶ç³»ç»Ÿçš„å®¹é‡ã€‚\nresize2fs é€»è¾‘å·è·¯å¾„\nå‘½ä»¤ç¤ºä¾‹: resize2fs /dev/vgdata/lvdata1\nå›æ˜¾ç±»ä¼¼å¦‚ä¸‹ä¿¡æ¯ï¼š\n1 2 resize2fs /dev/vgdata/lvdata1 resize2fs 1.42.9 (28-Dec-2013) Filesystem at /dev/vgdata/lvdata1 is mounted on /Data1; on-line resizing required old_desc_blocks = 4, new_desc_blocks = 28 The filesystem on /dev/vgdata/lvdata1 is now 3657728 blocks long. æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿå®¹é‡æ˜¯å¦å¢åŠ ã€‚\ndf -h å›æ˜¾ç±»ä¼¼å¦‚ä¸‹ä¿¡æ¯ï¼š\n1 2 3 4 5 6 7 8 9 10 df -h Filesystem Size Used Avail Use% Mounted on /dev/vda2 39G 1.5G 35G 5% / devtmpfs 487M 0 487M 0% /dev tmpfs 496M 0 496M 0% /dev/shm tmpfs 496M 6.7M 490M 2% /run tmpfs 496M 0 496M 0% /sys/fs/cgroup /dev/vda1 976M 131M 779M 15% /boot tmpfs 100M 0 100M 0% /run/user/0 /dev/mapper/vgdata-lvdata1 19G 44M 18G 1% /Data1 å¯ä»¥çœ‹åˆ°ï¼Œæ–‡ä»¶ç³»ç»Ÿâ€œ/dev/mapper/vgdata-lvdata1â€çš„å®¹é‡ç›¸æ¯”ä¹‹å‰å¢åŠ äº†4GBã€‚\né€»è¾‘å·ç¼©å®¹ ä¸å¯åœ¨çº¿æ“ä½œï¼Œéœ€è¦å…ˆumount æŒ‚è½½\nä¸»è¦å‘½ä»¤\numount /Data1 # /data1ä¸ºæŒ‚è½½è·¯å¾„ e2fsck -f /dev/vgdata/lvdata1 # è¿›è¡Œç£ç›˜æ£€æŸ¥ resize2fs /dev/vgdata/lvdata1 1G # è°ƒæ•´æ–‡ä»¶ç³»ç»Ÿ lvreduce -L 1GB /dev/vgdata/lvdata # é€šè¿‡lvduceå‘½ä»¤è¿›è¡Œç¼© mount /dev/vgdata/lvdata1 /Data1 # é‡æ–°æŒ‚è½½ 1 2 3 4 5 6 7 8 9 10 umount /Data1 # /data1ä¸ºæŒ‚è½½è·¯å¾„ mount |grep Data1|wc -l # æŸ¥çœ‹æ˜¯å¦æˆåŠŸå¸è½½ lvs |grep Data1 # æŸ¥çœ‹ç£ç›˜çŠ¶æ€ e2fsck -f /dev/vgdata/lvdata1 # è¿›è¡Œç£ç›˜æ£€æŸ¥ resize2fs /dev/vgdata/lvdata1 1G # è°ƒæ•´æ–‡ä»¶ç³»ç»Ÿ lvs |grep Data1 # æŸ¥çœ‹ç£ç›˜çŠ¶æ€ï¼Œæœªå‘ç”Ÿå˜åŒ– lvreduce -L 1GB /dev/vgdata/lvdata # é€šè¿‡lvduceå‘½ä»¤è¿›è¡Œç¼© lvs |grep Data1 # æŸ¥çœ‹ç£ç›˜çŠ¶æ€ï¼Œå¯å‘ç°å‡å°‘ mount /dev/vgdata/lvdata1 /Data1 # é‡æ–°æŒ‚è½½ df -lh |grep Data1 # æŸ¥çœ‹å½“å‰çŠ¶æ€ æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿ æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œåˆ›å»ºæ–‡ä»¶ç³»ç»Ÿã€‚ **mkfs.**æ–‡ä»¶æ ¼å¼ é€»è¾‘å·è·¯å¾„\nå‘½ä»¤ç¤ºä¾‹:\nmkfs.ext4 /dev/vgdata/lvdata1\nå›æ˜¾ç±»ä¼¼å¦‚ä¸‹ä¿¡æ¯ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 mkfs.ext4 /dev/vgdata/lvdata1 mke2fs 1.42.9 (28-Dec-2013) Filesystem label= OS type: Linux Block size=4096 (log=2) Fragment size=4096 (log=2) Stride=0 blocks, Stripe width=0 blocks 983040 inodes, 3932160 blocks 196608 blocks (5.00%) reserved for the super user First data block=0 Maximum filesystem blocks=2151677952 120 block groups 32768 blocks per group, 32768 fragments per group 8192 inodes per group Superblock backups stored on blocks: 32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208 Allocating group tables: done Writing inode tables: done Creating journal (32768 blocks): done Writing superblocks and filesystem accounting information: done æ‰‹åŠ¨æŒ‚è½½ å…·å¤‡æ–‡ä»¶ç³»ç»Ÿåæ‰å¯ä»¥æŒ‚è½½\nåˆ›å»ºæŒ‚è½½ç›®å½•ã€‚ mkdir æŒ‚è½½ç›®å½• å‘½ä»¤ç¤ºä¾‹: mkdir /Data1 æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå°†æ–‡ä»¶ç³»ç»ŸæŒ‚è½½åˆ°ç›®å½•ä¸‹ã€‚ mount é€»è¾‘å·è·¯å¾„ æŒ‚è½½ç›®å½• å‘½ä»¤ç¤ºä¾‹ï¼š mount /dev/vgdata/lvdata1 /Data1 æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼ŒæŸ¥è¯¢æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ä¿¡æ¯ã€‚ mount | grep æŒ‚è½½ç›®å½• å‘½ä»¤ç¤ºä¾‹ï¼š mount | grep /Data1 â€‹\tå›æ˜¾ç±»ä¼¼å¦‚ä¸‹ä¿¡æ¯ï¼š\n1 2 mount | grep /Data1 /dev/mapper/vgdata-lvdata1 on /Data1 type ext4 (rw,relatime,data=ordered) å¼€æœºè‡ªåŠ¨æŒ‚è½½ æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼Œè®¾ç½®äº‘æœåŠ¡å™¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿã€‚\næ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼ŒæŸ¥è¯¢æ–‡ä»¶ç³»ç»Ÿçš„UUIDã€‚\nblkid æ–‡ä»¶ç³»ç»Ÿè·¯å¾„\nä»¥æŸ¥è¯¢â€œdev/mapper/vgdata-lvdata1â€çš„UUIDä¸ºä¾‹ï¼š\nblkid /dev/mapper/vgdata-lvdata1\n1 2 blkid /dev/mapper/vgdata-lvdata1 /dev/mapper/vgdata-lvdata1: UUID=\u0026#34;c6a243ce-5150-41ac-8816-39db54d1a4b8\u0026#34; TYPE=\u0026#34;ext4\u0026#34; æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œæ‰“å¼€â€œ/etc/fstabâ€æ–‡ä»¶ã€‚\nvi /etc/fstab\n1 2 3 4 5 6 7 8 9 10 11 vi /etc/fstab # # /etc/fstab # Created by anaconda on Tue Nov 7 14:28:26 2017 # # Accessible filesystems, by reference, are maintained under \u0026#39;/dev/disk\u0026#39; # See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info # UUID=27f9be47-838b-4155-b20b-e4c5e013cdf3 / ext4 defaults 1 1 UUID=2b2000b1-f926-4b6b-ade8-695ee244a901 /boot ext4 defaults 1 2 æŒ‰â€œiâ€è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œå°†å…‰æ ‡ç§»è‡³æ–‡ä»¶æœ«å°¾ï¼ŒæŒ‰â€œEnterâ€ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ã€‚\n1 UUID=c6a243ce-5150-41ac-8816-39db54d1a4b8 /Data1 ext4 defaults 0 0 å†…å®¹è¯´æ˜å¦‚ä¸‹ï¼š\nç¬¬ä¸€åˆ—ï¼šUUIDï¼Œæ­¤å¤„å¡«å†™1æŸ¥è¯¢çš„UUIDï¼›\nç¬¬äºŒåˆ—ï¼šæ–‡ä»¶ç³»ç»Ÿçš„æŒ‚è½½ç›®å½•ï¼›\nç¬¬ä¸‰åˆ—ï¼šæ–‡ä»¶ç³»ç»Ÿçš„æ–‡ä»¶æ ¼å¼ï¼Œå¦‚æ–‡ä»¶æ ¼å¼â€œext4â€;\nç¬¬å››åˆ—ï¼šæŒ‚è½½é€‰é¡¹ï¼Œæ­¤å¤„ä»¥â€œdefaultsâ€ä¸ºä¾‹ï¼›\nç¬¬äº”åˆ—ï¼šå¤‡ä»½é€‰é¡¹ï¼Œè®¾ç½®ä¸ºâ€œ1â€æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨å¯¹è¯¥æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œå¤‡ä»½ï¼›è®¾ç½®ä¸ºâ€œ0â€æ—¶ï¼Œä¸è¿›è¡Œå¤‡ä»½ã€‚æ­¤å¤„ä»¥â€œ0â€ä¸ºä¾‹ï¼›\nç¬¬å…­åˆ—ï¼šæ‰«æé€‰é¡¹ï¼Œè®¾ç½®ä¸ºâ€œ1â€æ—¶ï¼Œç³»ç»Ÿåœ¨å¯åŠ¨æ—¶è‡ªåŠ¨å¯¹è¯¥æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œæ‰«æï¼›è®¾ç½®ä¸ºâ€œ0â€æ—¶ï¼Œä¸è¿›è¡Œæ‰«æã€‚æ­¤å¤„ä»¥â€œ0â€ä¸ºä¾‹ã€‚\næŒ‰â€œEscâ€ï¼Œè¾“å…¥â€œ:wq!â€ï¼Œå¹¶æŒ‰â€œEnterâ€ã€‚ä¿å­˜è®¾ç½®å¹¶é€€å‡ºviç¼–è¾‘å™¨ã€‚\næ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼ŒéªŒè¯è‡ªåŠ¨æŒ‚è½½åŠŸèƒ½\næ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå¸è½½æ–‡ä»¶ç³»ç»Ÿã€‚\numount é€»è¾‘å·è·¯å¾„\nå‘½ä»¤ç¤ºä¾‹ï¼š umount /dev/vgdata/lvdata1\næ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå°†/etc/fstabæ–‡ä»¶æ‰€æœ‰å†…å®¹é‡æ–°åŠ è½½ã€‚\nmount -a\næ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼ŒæŸ¥è¯¢æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ä¿¡æ¯ã€‚\nmount | grep æŒ‚è½½ç›®å½•\nå‘½ä»¤ç¤ºä¾‹ï¼š mount | grep /Data1\nå›æ˜¾ç±»ä¼¼å¦‚ä¸‹ä¿¡æ¯ï¼Œè¯´æ˜è‡ªåŠ¨æŒ‚è½½åŠŸèƒ½ç”Ÿæ•ˆï¼š\n1 2 mount | grep /Data1 /dev/mapper/vgdata-lvdata1 on /Data1 type ext4 (rw,relatime,data=ordered) â€‹\n","date":"2024-05-11T08:38:47Z","permalink":"https://blog.liu-nian.top/ops/lvm%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/","title":"LVMç›¸å…³å‘½ä»¤"},{"content":"èµ„æºè¦æ±‚ï¼š 4C/8G\nhttps://kind.sigs.k8s.io/docs/user/known-issues/#failure-to-create-cluster-with-cgroups-v2\ncentos 7 åœ¨çº¿å‡çº§å†…æ ¸ é»˜è®¤å†…æ ¸ç‰ˆæœ¬å¤ªä½\n![image-20240513154841260](/Users/yangzedong/Library/Application Support/typora-user-images/image-20240513154841260.png)\nå‚è€ƒé“¾æ¥ï¼šhttps://www.cnblogs.com/liugp/p/16950443.html\nå®‰è£…docker/kubectl kubectl :https://kubernetes.io/zh-cn/docs/tasks/tools/install-kubectl-linux/\n1 curl -LO \u0026#34;https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl\u0026#34; dockerï¼šhttps://www.runoob.com/docker/centos-docker-install.html\n1 curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun Helm:https://helm.sh/zh/docs/intro/install/\nå®‰è£…k8s å‚è€ƒæ–‡æ¡£ï¼šhttps://github.com/kubernetes-sigs/kind/tree/v0.22.0\nå®‰è£…kind äºŒè¿›åˆ¶æ–‡ä»¶\n1 [ $(uname -m) = x86_64 ] \u0026amp;\u0026amp; curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.21.0/kind-$(uname)-amd64 *å¯èƒ½æ¯”è¾ƒæ…¢ï¼Œå¯ä»¥é€‰æ‹©æ‰‹åŠ¨ä¸‹è½½å®‰è£…ï¼ŒäºŒè¿›åˆ¶åŒ…ä¸‹è½½åœ°å€ï¼šhttps://github.com/kubernetes-sigs/kind/releases\n1 2 3 4 # æ‰§è¡Œå®‰è£…æ“ä½œ chmod +x ./kind chmod +x ./kind mv ./kind /usr/local/bin/ æ‹‰å–é•œåƒï¼ˆå¯é€‰ï¼‰\n1 2 3 4 5 6 7 8 # é€‰ä¸€ä¸ªç‰ˆæœ¬ $ docker search kindest/node NAME DESCRIPTION STARS OFFICIAL kindest/node https://sigs.k8s.io/kind node image 104 kindest/node-amd64 2 kindest/node-arm64 0 # é•œåƒæ‹‰å– docker pull kindest/node å®‰è£…é›†ç¾¤\n1 2 3 4 # åœ¨çº¿åˆ›å»ºé›†ç¾¤ kind create cluster # æŒ‡å®š é…ç½®æ–‡ä»¶ # kind create cluster --config kind-example-config.yaml é…ç½®æ–‡ä»¶åœ°å€ï¼šhttps://kind.sigs.k8s.io/docs/user/configuration/\nå®‰è£…ingress\n1 2 3 4 5 6 7 8 9 10 11 # 1. è·å–yaml wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/static/provider/kind/deploy.yaml # 2. å› æœåŠ¡å™¨æ— å¤–ç½‘ï¼Œmacä¸Šè¿›è¡Œä¸‹è½½ï¼ŒæŒ‡å®šæ¶æ„ï¼šä¸€èˆ¬æ˜¯amd64å’Œarm64ã€aarch64 # registry.k8s.io/ingress-nginx/kube-webhook-certgen:v1.4.1 # registry.k8s.io/ingress-nginx/controller:v1.10.1 # registry.k8s.io/ingress-nginx/kube-webhook-certgen:v1.4.1 docker pull --platform amd64 xxx # 3. è£…è½½image kind load docker-image img:v1 # æˆ–è€… kind load image-archive my-image-archive.tar ![image-20240513220418988](/Users/yangzedong/Library/Application Support/typora-user-images/image-20240513220418988.png)\nkindæ¶æ„ å‚è€ƒæ–‡æ¡£ï¼šhttps://kind.sigs.k8s.io/docs/design/initial/\nk8sä¸­çš„ç«¯å£æ˜ å°„\nå‚è€ƒåœ°å€ï¼šhttps://www.cnblogs.com/baixiaoyong/p/16051137.html\nk8sä¸­çš„pod:https://fly-luck.github.io/2018/04/15/Kubernetes%20Ports/\ncontainerPort vs. hostPort å‡ºç°åœ¨å¦‚Deploymentã€Podç­‰èµ„æºå¯¹è±¡æè¿°æ–‡ä»¶ä¸­çš„å®¹å™¨éƒ¨åˆ†ï¼Œé’ˆå¯¹å®¹å™¨ç«¯å£èµ·ç±»ä¼¼äºdocker run -p \u0026lt;containerPort\u0026gt;:\u0026lt;hostPort\u0026gt;çš„ä½œç”¨ï¼š containerPortï¼šå®¹å™¨æš´éœ²çš„ç«¯å£ã€‚ hostPortï¼šå®¹å™¨æš´éœ²çš„ç«¯å£ç›´æ¥æ˜ å°„åˆ°çš„ä¸»æœºç«¯å£ã€‚\nport vs. targetPort vs. nodePort å‡ºç°åœ¨Serviceæè¿°æ–‡ä»¶ä¸­ï¼Œå½“Serviceçš„ç±»å‹ä¸ºClusterIPæ—¶ï¼š portï¼šServiceä¸­ClusterIPå¯¹åº”çš„ç«¯å£ã€‚ targetportï¼šclusterIPä½œä¸ºè´Ÿè½½å‡è¡¡ï¼Œ åç«¯ç›®æ ‡å®ä¾‹ï¼ˆå®¹å™¨ï¼‰çš„ç«¯å£ï¼Œä¸ä¸Šè¿°containerPortä¿æŒä¸€è‡´ã€‚\nå½“Serviceçš„ç±»å‹ä¸ºNodePortæ—¶ï¼š nodePortï¼šç”±äºClusterIPåªèƒ½é›†ç¾¤å†…è®¿é—®ï¼Œé…ç½®nodePortä¼šåœ¨æ¯ä¸ªè¿è¡ŒkubeletèŠ‚ç‚¹çš„å®¿ä¸»æœºæ‰“å¼€ä¸€ä¸ªç«¯å£ï¼Œç”¨äºé›†ç¾¤å¤–éƒ¨è®¿é—®ã€‚\n","date":"2024-05-11T08:38:25Z","permalink":"https://blog.liu-nian.top/ai/kind-%E5%AE%89%E8%A3%85k8s%E9%9B%86%E7%BE%A4/","title":"kind å®‰è£…k8sé›†ç¾¤"},{"content":"https://blog.csdn.net/qq836825331/article/details/136846624\nä¸‹è½½é•œåƒ Kustomizeå®‰è£… 1 2 curl -s \u0026#34;https://raw.githubusercontent.com/kubernetes-sigs/kustomize/master/hack/install_kustomize.sh\u0026#34; | bash chmod +x kustomize \u0026amp;\u0026amp; mv kustomize /usr/local/bin/ ä¸‹è½½é•œåƒ 1 2 3 4 5 6 7 wget https://github.com/kubeflow/manifests/archive/refs/tags/v1.8.1.tar.gz tar -zxvf v1.8.1.tar.gz cd v1.8.1 # è¿‡æ»¤å‡ºé•œåƒï¼Œæ³¨æ„éœ€è¦æ‰‹åŠ¨åšä¸‹æ’æŸ¥ kustomize build example |grep \u0026#39;image: \u0026#39;|awk \u0026#39;$2 != \u0026#34;\u0026#34; { print $2}\u0026#39; |sort -u # ä¸‹è½½é•œåƒï¼Œå¹¶pushåˆ°dockerhub \u0026#34;for i in `cat images.txt`; do docker pull $i ;tag_w=`echo \u0026#34;$i\u0026#34; | sed \u0026#39;s/\\//_/g\u0026#39;`;tag_new=\u0026#34;williamyang1/kubeflow_$tag_w\u0026#34;;docker tag $i $tag_new ;docker push $tag_new ;docker rmi $tag_new $i;echo \u0026#34;$tag_new\u0026#34; \u0026gt;\u0026gt; n_images.txt; done\u0026#34; æœ€ç»ˆçš„é•œåƒåˆ—è¡¨\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 williamyang1/busybox:1.28 williamyang1/docker.io_istio_pilot:1.17.5 williamyang1/docker.io_istio_proxyv2:1.17.5 williamyang1/docker.io_kubeflowkatib_earlystopping-medianstop:v0.16.0 williamyang1/docker.io_kubeflowkatib_enas-cnn-cifar10-cpu:v0.16.0 williamyang1/docker.io_kubeflowkatib_file-metrics-collector:v0.16.0 williamyang1/docker.io_kubeflowkatib_katib-controller:v0.16.0 williamyang1/docker.io_kubeflowkatib_katib-db-manager:v0.16.0 williamyang1/docker.io_kubeflowkatib_katib-ui:v0.16.0 williamyang1/docker.io_kubeflowkatib_mxnet-mnist:v0.16.0 williamyang1/docker.io_kubeflowkatib_pytorch-mnist-cpu:v0.16.0 williamyang1/docker.io_kubeflowkatib_suggestion-darts:v0.16.0 williamyang1/docker.io_kubeflowkatib_suggestion-enas:v0.16.0 williamyang1/docker.io_kubeflowkatib_suggestion-goptuna:v0.16.0 williamyang1/docker.io_kubeflowkatib_suggestion-hyperband:v0.16.0 williamyang1/docker.io_kubeflowkatib_suggestion-hyperopt:v0.16.0 williamyang1/docker.io_kubeflowkatib_suggestion-optuna:v0.16.0 williamyang1/docker.io_kubeflowkatib_suggestion-pbt:v0.16.0 williamyang1/docker.io_kubeflowkatib_suggestion-skopt:v0.16.0 williamyang1/docker.io_kubeflowkatib_tfevent-metrics-collector:v0.16.0 williamyang1/docker.io_kubeflowmanifestswg_oidc-authservice:e236439 williamyang1/docker.io_kubeflownotebookswg_centraldashboard:v1.8.0 williamyang1/docker.io_kubeflownotebookswg_jupyter-web-app:v1.8.0 williamyang1/docker.io_kubeflownotebookswg_kfam:v1.8.0 williamyang1/docker.io_kubeflownotebookswg_notebook-controller:v1.8.0 williamyang1/docker.io_kubeflownotebookswg_poddefaults-webhook:v1.8.0 williamyang1/docker.io_kubeflownotebookswg_profile-controller:v1.8.0 williamyang1/docker.io_kubeflownotebookswg_pvcviewer-controller:v1.8.0 williamyang1/docker.io_kubeflownotebookswg_tensorboard-controller:v1.8.0 williamyang1/docker.io_kubeflownotebookswg_tensorboards-web-app:v1.8.0 williamyang1/docker.io_kubeflownotebookswg_volumes-web-app:v1.8.0 williamyang1/docker.io_metacontrollerio_metacontroller:v2.0.4 williamyang1/docker.io_seldonio_mlserver:1.3.2 williamyang1/gcr.io_knative-releases_knative.dev_eventing_cmd_controller@sha256:92967bab4ad8f7d55ce3a77ba8868f3f2ce173c010958c28b9a690964ad6ee9b williamyang1/gcr.io_knative-releases_knative.dev_eventing_cmd_mtping@sha256:6d35cc98baa098fc0c5b4290859e363a8350a9dadc31d1191b0b5c9796958223 williamyang1/gcr.io_knative-releases_knative.dev_eventing_cmd_webhook@sha256:ebf93652f0254ac56600bedf4a7d81611b3e1e7f6526c6998da5dd24cdc67ee1 williamyang1/gcr.io_knative-releases_knative.dev_net-istio_cmd_controller@sha256:421aa67057240fa0c56ebf2c6e5b482a12842005805c46e067129402d1751220 williamyang1/gcr.io_knative-releases_knative.dev_net-istio_cmd_webhook@sha256:bfa1dfea77aff6dfa7959f4822d8e61c4f7933053874cd3f27352323e6ecd985 williamyang1/gcr.io_knative-releases_knative.dev_serving_cmd_activator@sha256:c2994c2b6c2c7f38ad1b85c71789bf1753cc8979926423c83231e62258837cb9 williamyang1/gcr.io_knative-releases_knative.dev_serving_cmd_autoscaler@sha256:8319aa662b4912e8175018bd7cc90c63838562a27515197b803bdcd5634c7007 williamyang1/gcr.io_knative-releases_knative.dev_serving_cmd_controller@sha256:98a2cc7fd62ee95e137116504e7166c32c65efef42c3d1454630780410abf943 williamyang1/gcr.io_knative-releases_knative.dev_serving_cmd_domain-mapping@sha256:f66c41ad7a73f5d4f4bdfec4294d5459c477f09f3ce52934d1a215e32316b59b williamyang1/gcr.io_knative-releases_knative.dev_serving_cmd_domain-mapping-webhook@sha256:7368aaddf2be8d8784dc7195f5bc272ecfe49d429697f48de0ddc44f278167aa williamyang1/gcr.io_knative-releases_knative.dev_serving_cmd_queue@sha256:dabaecec38860ca4c972e6821d5dc825549faf50c6feb8feb4c04802f2338b8a williamyang1/gcr.io_knative-releases_knative.dev_serving_cmd_webhook@sha256:4305209ce498caf783f39c8f3e85dfa635ece6947033bf50b0b627983fd65953 williamyang1/gcr.io_kubebuilder_kube-rbac-proxy:v0.13.1 williamyang1/gcr.io_kubebuilder_kube-rbac-proxy:v0.8.0 williamyang1/gcr.io_ml-pipeline_api-server:2.0.5 williamyang1/gcr.io_ml-pipeline_cache-server:2.0.5 williamyang1/gcr.io_ml-pipeline_frontend williamyang1/gcr.io_ml-pipeline_frontend:2.0.5 williamyang1/gcr.io_ml-pipeline_metadata-writer:2.0.5 williamyang1/gcr.io_ml-pipeline_minio:RELEASE.2019-08-14T20-37-41Z-license-compliance williamyang1/gcr.io_ml-pipeline_mysql:8.0.26 williamyang1/gcr.io_ml-pipeline_persistenceagent:2.0.5 williamyang1/gcr.io_ml-pipeline_scheduledworkflow:2.0.5 williamyang1/gcr.io_ml-pipeline_viewer-crd-controller:2.0.5 williamyang1/gcr.io_ml-pipeline_visualization-server williamyang1/gcr.io_ml-pipeline_workflow-controller:v3.3.10-license-compliance williamyang1/gcr.io_tfx-oss-public_ml_metadata_store_server:1.14.0 williamyang1/ghcr.io_dexidp_dex:v2.36.0 williamyang1/kserve_kserve-controller:v0.11.2 williamyang1/kserve_lgbserver:v0.11.2 williamyang1/kserve_models-web-app:v0.10.0 williamyang1/kserve_paddleserver:v0.11.2 williamyang1/kserve_pmmlserver:v0.11.2 williamyang1/kserve_sklearnserver:v0.11.2 williamyang1/kserve_xgbserver:v0.11.2 williamyang1/kubeflow_training-operator:v1-855e096 williamyang1/mysql:8.0.29 williamyang1/nvcr.io_nvidia_tritonserver:23.05-py3 williamyang1/python:3.7 williamyang1/pytorch_torchserve-kfs:0.8.2 williamyang1/quay.io_jetstack_cert-manager-cainjector:v1.12.2 williamyang1/quay.io_jetstack_cert-manager-controller:v1.12.2 williamyang1/quay.io_jetstack_cert-manager-webhook:v1.12.2 williamyang1/tensorflow_serving:2.6.2 å®‰è£…k8s Kubesphere å®‰è£…k8s\u0026ndash;v1.27.10 https://kubesphere.io/zh/docs/v3.4/quick-start/all-in-one-on-linux/\nhttps://kubesphere.io/zh/blogs/using-kubekey-deploy-k8s-v1.28.8/\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 # å®‰è£…åŸºç¡€è½¯ä»¶ yum install -y socat conntrack ebtables ipset ipvsadm # å®‰è£…å·¥å…· # shellå®‰è£… æˆ–è€…ç¦»çº¿ä¸‹è½½ curl -sfL https://get-kk.kubesphere.io | sh - ## ç¦»çº¿ä¸‹è½½ https://github.com/kubesphere/kubekey/releases/download/v3.1.1/kubekey-v3.1.1-linux-amd64.tar.gz chmod +x kk mv kk /usr/local/bin/ # ç¡®è®¤æ˜¯å¦åŒ…å«æƒ³è¦å®‰è£…çš„ç‰ˆæœ¬ kk version --show-supported-k8s # åˆ›å»ºmanifest å¯¼å‡ºä¾›ç¦»çº¿ä¸‹è½½ä½¿ç”¨ kk create manifest --with-kubernetes v1.27 # ä¸‹è½½åŸºç¡€ç¯å¢ƒé•œåƒ-manifestç”¨åˆ°çš„å·¥å…·ï¼Œå•ç‹¬ä¸‹è½½--å¯é€‰ # é•œåƒæ‰€åœ¨åœ°å€ https://github.com/kubesphere/kubekey/releases/tag/v3.1.1 # æ‰¾ä¸€å°è®¿é—®é€Ÿåº¦å¿«çš„æœºå™¨ä¸‹è½½ https://github.com/kubesphere/kubekey/releases/download/v3.1.1/centos7-rpms-amd64.iso # è¿™ä¸€æ­¥éª¤ä¼šä¸‹è½½manifest-sample.yamlä¸­æ¶‰åŠçš„çš„å·¥å…·å¦‚kubelet/containerd/helmç­‰ ./kk artifact export -m manifest-sample.yaml -o kubesphere.tar.gz # æ­¤æ­¥éª¤ä¸ºæ–¹ä¾¿æ²¡æœ‰å¤–ç½‘çš„æœºå™¨åˆ›å»ºé›†ç¾¤ã€‚ ./kk create cluster -f config-sample.yaml -a kubesphere.tar.gz --with-packages å®‰è£…kubeflow https://github.com/kubeflow/manifests\n1 2 # ä¸‹è½½é•œåƒ for i in `cat images.txt`; do ctr imgaes pull $i ;done ","date":"2024-05-11T08:38:25Z","permalink":"https://blog.liu-nian.top/ai/kubeflow%E5%AE%89%E8%A3%85/","title":"Kubeflow å®‰è£…"},{"content":"å‚è€ƒæ–‡çŒ®ï¼šhttps://www.jianshu.com/p/d78fff321005\næ•°æ®å­˜å‚¨æ ¼å¼ï¼šWKT VS GeoJSON WKTæ˜¯ä»€ä¹ˆï¼Ÿ WKT(well-know text)æ˜¯å¼€æ”¾åœ°ç†ç©ºé—´è”ç›ŸOGCåˆ¶å®šçš„ä¸€ç§æ–‡æœ¬æ ‡è®°è¯­è¨€ï¼Œç”¨äºè¡¨ç¤ºçŸ¢é‡å‡ ä½•å¯¹è±¡ã€ç©ºé—´å‚ç…§ç³»ç»ŸåŠç©ºé—´å‚ç…§ç³»ç»Ÿä¹‹é—´çš„è½¬æ¢ã€‚\nWKBæ˜¯ä»€ä¹ˆï¼Ÿ WKB(well-know binary)æ˜¯WKTçš„äºŒè¿›åˆ¶è¡¨ç°å½¢å¼ï¼Œè§£å†³WKTè¡¨è¾¾å†—ä½™çš„é—®é¢˜ï¼Œä¾¿äºä¼ è¾“å’Œå­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚\nGeoJSONæ˜¯ä»€ä¹ˆï¼Ÿ ä»¥JSONçš„æ ¼å¼è¾“å‡ºç©ºé—´æ•°æ®ï¼Œä¾¿äºè¢«javascriptç­‰è„šæœ¬è°ƒç”¨ã€‚\nWKTä¸GeoJSON WKTä¸GeoJSONåˆ†ä¸ºç‚¹ã€çº¿ã€é¢ã€å‡ ä½•é›†åˆå››ç§ï¼š ç‚¹ çº¿ é¢ ç»„åˆ Point MultiPoint LineString MultiLineString Polygon MultiPolygon GeometryCollection ç±»å‹ WKT GeoJSON Point POINT(10 10) { \u0026ldquo;type\u0026rdquo;: \u0026ldquo;Point\u0026rdquo;, \u0026ldquo;coordinates\u0026rdquo;: [10, 10] } LineString LINESTRING(10 10, 20 30) { \u0026ldquo;type\u0026rdquo;: \u0026ldquo;Point\u0026rdquo;, \u0026ldquo;coordinates\u0026rdquo;:[ [10, 10], [20, 30] ] } Polygon POLYGON(10 10, 15 16, 22 10, 30 32) { \u0026ldquo;type\u0026rdquo;: \u0026ldquo;Polygon\u0026rdquo;, \u0026ldquo;coordinates\u0026rdquo;: [ [ [10, 10], [10, 10], [10, 10], [10, 10] ] ] } MultiPoint MULTIPOINT(*) { \u0026ldquo;type\u0026rdquo;: \u0026ldquo;MultiPoint\u0026rdquo;, \u0026ldquo;coordinates\u0026rdquo;: [*] } MultiLineString MULTILINESTRING (*) { \u0026ldquo;type\u0026rdquo;: \u0026ldquo;MultiLineString\u0026rdquo;, \u0026ldquo;coordinates\u0026rdquo;: [*] } MultiPolygon MULTIPOLYGON (*) { \u0026ldquo;type\u0026rdquo;: \u0026ldquo;MultiPolygon\u0026rdquo;, \u0026ldquo;coordinates\u0026rdquo;: [*] } GEOMETRYCOLLECTION GEOMETRYCOLLECTION(POINT(2 3),LINESTRING(2 3,3 4)) - WKTä¸GeoJSONçš„åŒºåˆ« WKTæ˜¯ç”¨æ¥å•ç‹¬è¡¨ç¤ºç©ºé—´ç‚¹ã€çº¿ã€é¢æ•°æ®ï¼ŒGeoJSONè¿˜å¯ä»¥ç”¨æ¥è¡¨ç¤ºç©ºé—´æ•°æ®å’Œå±æ€§æ•°æ®çš„é›†åˆ ï¼ˆcrsã€bboxå±æ€§ï¼‰ã€‚ ä½¿ç”¨GeoPandas è¯»å– wktå­—ç¬¦ä¸²æ•°æ® è·å–å±±ä¸œçœåœ°å›¾åœŸåœ°è½®å»“å¹¶ä½¿ç”¨GeoPandasåŠ è½½å±•ç¤º\né€šè¿‡ç™¾åº¦åœ°å›¾apiè·å–æ•°æ®ä¿¡æ¯ å°†å½¢çŠ¶å­—ç¬¦ä¸²è½¬æ¢ä¸ºMultiPolygonç±»å‹æ•°æ® é€šè¿‡GeoPandasåŠ è½½æ•°æ® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 # encoding:utf-8 # æ ¹æ®æ‚¨é€‰æ‹©çš„AKå·²ä¸ºæ‚¨ç”Ÿæˆè°ƒç”¨ä»£ç  # æ£€æµ‹åˆ°æ‚¨å½“å‰çš„AKè®¾ç½®äº†IPç™½åå•æ ¡éªŒ # æ‚¨çš„IPç™½åå•ä¸­çš„IPéå…¬ç½‘IPï¼Œè¯·è®¾ç½®ä¸ºå…¬ç½‘IPï¼Œå¦åˆ™å°†è¯·æ±‚å¤±è´¥ # è¯·åœ¨IPåœ°å€ä¸º0.0.0.0/0 å¤–ç½‘IPçš„è®¡ç®—å‘èµ·è¯·æ±‚ï¼Œå¦åˆ™å°†è¯·æ±‚å¤±è´¥ import requests sds =None # æœåŠ¡åœ°å€ host = \u0026#34;https://api.map.baidu.com\u0026#34; # æ¥å£åœ°å€ uri = \u0026#34;/api_region_search/v1/\u0026#34; # æ­¤å¤„å¡«å†™ä½ åœ¨æ§åˆ¶å°-åº”ç”¨ç®¡ç†-åˆ›å»ºåº”ç”¨åè·å–çš„AK ak = \u0026#34;\u0026#34; params = { \u0026#34;keyword\u0026#34;: \u0026#34;å±±ä¸œçœ\u0026#34;, \u0026#34;sub_admin\u0026#34;: \u0026#34;0\u0026#34;, \u0026#34;ak\u0026#34;: ak, \u0026#34;extensions_code\u0026#34;:1, \u0026#34;boundary\u0026#34;:1, } response = requests.get(url = host + uri, params = params) sds =None if response: # print(response.json()) sds = response.json() print(sds[\u0026#39;districts\u0026#39;]) # pd.DataFrame(sds[\u0026#39;districts\u0026#39;]) ","date":"2024-05-11T08:38:25Z","permalink":"https://blog.liu-nian.top/ai/%E5%9C%B0%E7%90%86%E4%BF%A1%E6%81%AF%E5%8F%AF%E8%A7%86%E5%8C%96/","title":"åœ°ç†ä¿¡æ¯å¯è§†åŒ–"}]